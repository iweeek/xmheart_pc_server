/**
 * Created by 123 on 16/4/5.
 */

/*
 * 
 * 动态高度的计算
 * 
 */

//$(document).ready(function(){
//	function load(){
//		console.log($('.nav-header').length);
//	};
//	setTimeout(load,200); 
//});

/*----------------------------------   数据处理部分  ---------------------------------------------*/
var app = angular.module('manager', ['angular-growl', 'ipCookie', 'jkuri.datepicker']);

// 配置
app.config(['growlProvider',function(growlProvider){
    growlProvider.onlyUniqueMessages(true);
}]);
app.config(['growlProvider',function(growlProvider){
    growlProvider.globalTimeToLive(1000);
}]);

app.controller('managerLogin',function($scope,ipCookie,growl){

    // 用户名
    $scope.userName= null;
    // 密码
    $scope.userPassword = null;

    // 登录函数
    function login(){
        if(!$scope.userName){
            growl.addInfoMessage("请输入您的用户名!");
        }
        else if(!$scope.userPassword){
            growl.addInfoMessage("请输入您的密码！");
        }
        else {
            $.ajax({
                url:"system.do?method=login",
                type:"POST",
                data:{"account":$scope.userName,"pass":$scope.userPassword},
                success:function(response){
                    var tag = response.json;
                    if(tag != -1 && tag != -2) {
                        ipCookie("userName",$scope.userName,{expires:1});
                        ipCookie('key',tag,{expires:1});
                        window.location.href = "templet/manager.html";
                    }
                    else if(tag == -1) {
                        swal({
                            title:"账号或者密码错误!",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                    else if(tag == -2){
                        swal({
                            title:"登录失败!",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                },
                error:function(response){
                    swal({
                        title:"网络错误!",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                    });
                }
            });
        }
    }

    // 回车登录
    $(document).keydown(function(e){
        e = e || window.event;
        if(e.keyCode == 13){
            login();
        }
    });

    // 按钮登录
    $scope.login = login;

});

/*--------------------------------------------------首页模块*/
app.controller('managerActivityMode',function($scope,ipCookie,growl){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }


    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 图片
    $scope.picture1 = "../images/test.png";
    $scope.picture2 = "../images/test.png";
    $scope.picture3 = "../images/test.png";
    $scope.picture4 = "../images/test.png";

    // 默认显示APP配置
    $scope.bannerType = 0;

    $("#typeSelectInput").on("change",function(){
		$scope.bannerType = $(this).find("option:selected").val()
		$scope.$apply();
		console.log($scope.bannerType);
		if ($scope.bannerType == 0) {
			getImgList();
		} else {
			getBannerList();
		}
	});

    // 获得图片
    function getImgList(){
        $.ajax({
            url:'system.do?method=getModelPicture',
            type:"POST",
            success:function(response){
                var result = response.json;
                var temp1 = result.aPicture;
                var temp2 = result.bPicture;
                var temp3 = result.cPicture;
                var temp4 = result.dPicture;

                if(temp1.substring(temp1.length, temp1.length - 4) == 'null'){

                }
                else {
                    $scope.picture1 = temp1;
                }

                if(temp2.substring(temp2.length, temp2.length - 4) == 'null'){

                }
                else {
                    $scope.picture2 = temp2;
                }

                if(temp3.substring(temp3.length, temp3.length - 4) == 'null'){

                }
                else {
                    $scope.picture3 = temp3;
                }

                if(temp4.substring(temp4.length, temp4.length - 4) == 'null'){

                }
                else {
                    $scope.picture4 = temp4;
                }

                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getImgList();

  	// 获得图片
    function getBannerList(){
        $.ajax({
            url:'system.do?method=bannerListGet',
            type:"POST",
            success:function(response){
                var resultList = response.data;
                $scope.banner0 = resultList[0];
				$scope.banner1 = resultList[1];
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getBannerList();

    // 上传注册模块
    $scope.upload1 = function(){
        if(!$('#typeOne').prop('files')[0]){
            swal({
                title:"请选择图片！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            swal({
                title:"确定上传？",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"
            },
                function(){
                    var formdata = new FormData();
                    formdata.append('type',1);
                    formdata.append('picture',$('#typeOne').prop('files')[0]);
                    formdata.append('account',$scope.userName);

                    $.ajax({
                        url:"system.do?method=modelPicture",
                        type:"POST",
                        data:formdata,
                        contentType: false,
                        processData: false,
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                getImgList();
                                $('#typeOne').val("");
                            }
                            else {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );
        }
    }

    // 上传快递规则
    $scope.upload2 = function(){
        if(!$('#typeTwo').prop('files')[0]){
            swal({
                title:"请选择图片！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            swal({
                    title:"确定上传？",
                    text:"",
                    type:"info",
                    showCancelButton:true,
                    closeOnConfirm:false,
                    showLoaderOnConfirm:true,
                    confirmButtonText:"确认",
                    cancelButtonText:"取消"
                },
                function(){
                    var formdata = new FormData();
                    formdata.append('type',2);
                    formdata.append('picture',$('#typeTwo').prop('files')[0]);
                    formdata.append('account',$scope.userName);
                    $.ajax({
                        url:"system.do?method=modelPicture",
                        type:"POST",
                        data:formdata,
                        contentType: false,
                        processData: false,
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                getImgList();
                                $('#typeTwo').val("");
                            }
                            else {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );
        }
    }

    $scope.upload3 = function(){
        if(!$('#typeThree').prop('files')[0]){
            swal({
                title:"请选择图片！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            swal({
                    title:"确定上传？",
                    text:"",
                    type:"info",
                    showCancelButton:true,
                    closeOnConfirm:false,
                    showLoaderOnConfirm:true,
                    confirmButtonText:"确认",
                    cancelButtonText:"取消"
                },
                function(){
                    var formdata = new FormData();
                    formdata.append('type',3);
                    formdata.append('picture',$('#typeThree').prop('files')[0]);
                    formdata.append('account',$scope.userName);
                    $.ajax({
                        url:"system.do?method=modelPicture",
                        type:"POST",
                        data:formdata,
                        contentType: false,
                        processData: false,
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                getImgList();
                                $("#typeThree").val("");
                            }
                            else {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );
        }
    }

    $scope.upload4 = function(){
        if(!$('#typeFour').prop('files')[0]){
            swal({
                title:"请选择图片！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            swal({
                    title:"确定上传？",
                    text:"",
                    type:"info",
                    showCancelButton:true,
                    closeOnConfirm:false,
                    showLoaderOnConfirm:true,
                    confirmButtonText:"确认",
                    cancelButtonText:"取消"
                },
                function(){
                    var formdata = new FormData();
                    formdata.append('type',4);
                    formdata.append('picture',$('#typeFour').prop('files')[0]);
                    formdata.append('account',$scope.userName);
                    $.ajax({
                        url:"system.do?method=modelPicture",
                        type:"POST",
                        data:formdata,
                        contentType: false,
                        processData: false,
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                getImgList();
                                $("#typeFour").val("");
                            }
                            else {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );
        }
    }

    $scope.updateBanner0 = function(){
        if(!$('#banner0').prop('files')[0]){
            swal({
                title:"请选择图片！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            swal({
                    title:"确定保存？",
                    text:"",
                    type:"info",
                    showCancelButton:true,
                    closeOnConfirm:false,
                    showLoaderOnConfirm:true,
                    confirmButtonText:"确认",
                    cancelButtonText:"取消"
                },
                function(){
                    var formdata = new FormData();
                    formdata.append('picture',$('#banner0').prop('files')[0]);
                    formdata.append('id',1);
                    formdata.append('title',$scope.banner0.title);
                    formdata.append('url',$scope.banner0.url);
                    $.ajax({
                        url:"system.do?method=bannerUpdate",
                        type:"POST",
                        data:formdata,
                        contentType: false,
                        processData: false,
                        success:function(response){
                            var tag = response.code;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                getBannerList();
                                $("#banner0").val("");
                            }
                            else {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );
        }
    }

    $scope.updateBanner1 = function(){
        if(!$('#banner1').prop('files')[0]){
            swal({
                title:"请选择图片！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            swal({
                    title:"确定保存？",
                    text:"",
                    type:"info",
                    showCancelButton:true,
                    closeOnConfirm:false,
                    showLoaderOnConfirm:true,
                    confirmButtonText:"确认",
                    cancelButtonText:"取消"
                },
                function(){
                    var formdata = new FormData();
                    formdata.append('picture',$('#banner1').prop('files')[0]);
                    formdata.append('id',2);
                    formdata.append('title',$scope.banner1.title);
                    formdata.append('url',$scope.banner1.url);
                    $.ajax({
                        url:"system.do?method=bannerUpdate",
                        type:"POST",
                        data:formdata,
                        contentType: false,
                        processData: false,
                        success:function(response){
                            var tag = response.code;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                getBannerList();
                                $("#banner1").val("");
                            }
                            else {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );
        }
    }
});

/*--------------------------------------------------新闻列表*/
app.controller('managerNews',function($scope,ipCookie,growl){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }

    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }


    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 获取公告列表
    $scope.newsList = [];
    $scope.pageIndex = 1;
    function getNewsList(){
        $.ajax({
            url:"system.do?method=broadcastList",
            type:"POST",
            data:{'page':$scope.pageIndex},
            success:function(response){
                var result = response.json;
                $scope.newsList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }

        });
    }
    getNewsList();

    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前是第一页!",
                text:"",
                type:"info",
                confirmButtonText:'确认'
            });
        }
        else {
            $scope.pageIndex--;
            getNewsList();
        }
    }

    // 后一页
    $scope.next = function(){
        $.ajax({
            url:"system.do?method=broadcastList",
            type:"POST",
            data:{'page':$scope.pageIndex + 1},
            success:function(response){
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多数据!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.newsList = result;
                    $scope.pageIndex++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }

        });
    }

    // 获取公告详情
    $scope.lookInfo = function(index){
        swal({
            title:$scope.newsList[index].title,
            text:$scope.newsList[index].content,
            type:"info",
            confirmButtonText:"确认"
        });
    }


    // 新闻标题
    $scope.newsTitle = null;
    // 新闻内容
    $scope.newsContent = null;

    // 发布新闻
    $scope.sendNews = function(){

        if(!$scope.newsTitle){
            growl.addInfoMessage("请输入公告的标题");
        }
        else if(!$scope.newsContent){
            growl.addInfoMessage("请输入公告的内容");
        }
        else {


            swal({
                    title:"是否发布公告？",
                    text:"",
                    type:"info",
                    animation:"slide-from-top",
                    showCancelButton:true,
                    cancelButtonText:"取消",
                    closeOnConfirm:false,
                    showLoaderOnConfirm:true,
                    confirmButtonText:"确认"
                },
                function(){
                    $.ajax({
                        url:"system.do?method=broadcast",
                        type:'POST',
                        data:{"title":$scope.newsTitle,"content":$scope.newsContent,'account':$scope.userName},
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"操作成功！",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });
                                getNewsList();

                                // 新闻标题
                                $scope.newsTitle = null;
                                // 新闻内容
                                $scope.newsContent = null;
                            }
                            else {
                                swal({
                                    title:"操作失败！",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误！",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );

        }


    }


    // 删除新闻
    $scope.deleteInfo = function(index){
        swal({
            title:"确定删除公告？",
            text:"",
            type:"info",
            animation:"slide-from-top",
            showCancelButton:true,
            cancelButtonText:"取消",
            closeOnConfirm:false,
            showLoaderOnConfirm:true,
            confirmButtonText:"确认"
        },
            function(){
                $.ajax({
                    url:"system.do?method=deleteBroadcast",
                    type:"POST",
                    data:{"opTime":$scope.newsList[index].opTime,'account':$scope.userName},
                    success:function(response){
                        var tag = response.json;
                        if(tag == 1){
                            swal({
                                title:"操作成功！",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });
                            getNewsList();

                        }
                        else {
                            swal({
                                title:"操作失败！",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(){
                        swal({
                            title:"网络错误！",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
        );
    }

});


/*---------------------------------------------------预存记录------------------------*/
app.controller('chargeRecord', function($scope, ipCookie) {

	$scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    // 搜索名字关键词
    $scope.nameSearch = null;

    // 数据列表
    $scope.consumeList = null;

    // 当前的页数
    $scope.pageIndex = 1;

    // 活动时间
    // $(".startTime").datetimepicker({
    // format: 'yyyy-mm-dd hh:ii',
    // language: 'zh-CN',
    // autoclose: true,
    // todayHightlight: true,
    // minView: 'hour'
    // });
    // $(".endTime").datetimepicker({
    // format: 'yyyy-mm-dd hh:ii',
    // language: 'zh-CN',
    // autoclose: true,
    // todayHightlight: true,
    // minView: 'hour'
    // });

    // 获取预存记录
    function getChargeRecordList(){
       $.ajax({
           url:"wallet.do?method=getAllRechargeRecord",
           type:'POST',
           data:{"page": $scope.pageIndex},
           success: function (response) {
               if(response.code == 1) {
                    $scope.chargeRecordList = response.data;
                    console.log($scope.chargeRecordList)
               }else {
                    swal({
                       title:"网络错误!",
                       text:"",
                       type:"error",
                       confirmButtonText:"确认"
                    });
               }
               // 刷新数据
               $scope.$apply();
           },
           error:function(){
               swal({
                   title:"网络错误!",
                   text:"",
                   type:"error",
                   confirmButtonText:"确认"
               });
           }
       });
    }

    getChargeRecordList();

    $scope.search = function(){
    	// var startTime = new Date($('.startTime').val()).getTime();
    	// var endTime = new Date($('.endTime').val()).getTime();



// $.ajax({
// url:"client.do?method=userSearch",
// type:'POST',
// data:{
// 'phone':$scope.phoneSearch
// },
// success:function(response){
// var result = response.json;
// if(result[0].photo.indexOf('null') != -1){
// result[0].photo = "../images/default.png";
//
// }
// $scope.users = result;
// $scope.$apply();
// },
// error:function(){
// swal({
// title:"网络错误!",
// text:'',
// type:'error',
// confirmButtonText:"确认"
// });
// }
// });


    }

    // 前一页
    $scope.pre = function () {
        if($scope.pageIndex == 1) {
            swal({
                title:"当前已经是第一页！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;

            getChargeRecordList();
        }
    }

    // 后一页
    $scope.next = function(){
        $.ajax({
            url:"wallet.do?method=getAllRechargeRecord",
            type:'POST',
            data:{"page": $scope.pageIndex + 1},
            success: function (response) {
                if(response.code == 1) {
                    if(response.data.length > 0) {
                        $scope.chargeRecordList = response.data;
                        $scope.pageIndex++;
                        $scope.$apply();
                    }else {
                        swal({
                           title:"没有更多数据！",
                           text:"",
                           type:"info",
                           confirmButtonText:"确认"
                        });

                    }
                }else {
                     swal({
                        title:"网络错误!",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                     });
                }
                // 刷新数据
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });

    }


});

/*---------------------------------------------------消费记录------------------------*/
app.controller('consumeRecord', function($scope, ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    // 搜索名字关键词
    $scope.nameSearch = null;

    // 数据列表
    $scope.consumeList = null;

    // 当前的页数
    $scope.pageIndex = 1;

    // 活动时间
    // $(".startTime").datetimepicker({
    // format: 'yyyy-mm-dd hh:ii',
    // language: 'zh-CN',
    // autoclose: true,
    // todayHightlight: true,
    // minView: 'hour'
    // });
    // $(".endTime").datetimepicker({
    // format: 'yyyy-mm-dd hh:ii',
    // language: 'zh-CN',
    // autoclose: true,
    // todayHightlight: true,
    // minView: 'hour'
    // });

    // 获取消费记录
    function getConsumeRecordList(){
       $.ajax({
           url:"wallet.do?method=getAllOutcomeRecord",
           type:'POST',
           data:{"page": $scope.pageIndex},
           success: function (response) {
               if(response.code == 1) {
                    $scope.consumeRecordList = response.data;
                    console.log($scope.consumeRecordList)
               }else {
                    swal({
                       title:"网络错误!",
                       text:"",
                       type:"error",
                       confirmButtonText:"确认"
                    });
               }
               // 刷新数据
               $scope.$apply();
           },
           error:function(){
               swal({
                   title:"网络错误!",
                   text:"",
                   type:"error",
                   confirmButtonText:"确认"
               });
           }
       });
    }

    getConsumeRecordList();

    $scope.search = function(){
        // var startTime = new Date($('.startTime').val()).getTime();
        // var endTime = new Date($('.endTime').val()).getTime();



// $.ajax({
// url:"client.do?method=userSearch",
// type:'POST',
// data:{
// 'phone':$scope.phoneSearch
// },
// success:function(response){
// var result = response.json;
// if(result[0].photo.indexOf('null') != -1){
// result[0].photo = "../images/default.png";
//
// }
// $scope.users = result;
// $scope.$apply();
// },
// error:function(){
// swal({
// title:"网络错误!",
// text:'',
// type:'error',
// confirmButtonText:"确认"
// });
// }
// });


    }

    // 前一页
    $scope.pre = function () {
        if($scope.pageIndex == 1) {
            swal({
                title:"当前已经是第一页！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;

            getConsumeRecordList();
        }
    }

    // 后一页
    $scope.next = function(){
        $.ajax({
            url:"wallet.do?method=getAllOutcomeRecord",
            type:'POST',
            data:{"page": $scope.pageIndex + 1},
            success: function (response) {
                if(response.code == 1) {
                    if(response.data.length > 0) {
                        $scope.consumeRecordList = response.data;
                        $scope.pageIndex++;
                        $scope.$apply();
                    }else {
                        swal({
                           title:"没有更多数据！",
                           text:"",
                           type:"info",
                           confirmButtonText:"确认"
                        });

                    }
                }else {
                     swal({
                        title:"网络错误!",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                     });
                }
                // 刷新数据
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });

    }


});

/*--------------------------------------------------用户列表*/
app.controller('usersList', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }


    // 数据列表
    $scope.users = null;

    // 当前的页数
    $scope.pageIndex = 1;

    $scope.phoneSearch = null;

    // 用户性别信息
    $scope.sexString = ["未设置","男","女"];

    // 获取用户数据
    function getUserList(){
        $.ajax({
            url:"client.do?method=userList",
            type:'POST',
            data:{"page":$scope.pageIndex},
            success: function (response) {
                var result = response.json;
                $.each(result,function(index,value){
                    if(value.photo.indexOf('null') != -1){
                        value.photo = "../images/default.png";

                    }
                });
                $scope.users = result;
                // 刷新数据
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getUserList();

    $scope.search = function(){

        if(!$scope.phoneSearch){
            swal({
                title:"请输入搜索的手机号码！",
                text:"",
                type:'info',
                confirmButtonText:"确认"
            })
        }
        else {
            $.ajax({
                url:"client.do?method=userSearch",
                type:'POST',
                data:{
                    'phone':$scope.phoneSearch
                },
                success:function(response){
                    var result = response.json;
                    if(result[0].photo.indexOf('null') != -1){
                        result[0].photo = "../images/default.png";

                    }
                    $scope.users = result;
                    $scope.$apply();
                },
                error:function(){
                    swal({
                        title:"网络错误!",
                        text:'',
                        type:'error',
                        confirmButtonText:"确认"
                    });
                }
            });
        }

    }

    // 前一页
    $scope.pre = function () {
        if($scope.pageIndex == 1) {
            swal({
                title:"当前已经是第一页！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;

            getUserList();
        }
    }

    // 后一页
    $scope.next = function(){

        $.ajax({
            url:"client.do?method=userList",
            type:'POST',
            data:{"page":$scope.pageIndex+1},
            success:function(response){
                var result = response.json;
                if(result.length == 0) {
                    swal({
                        title:"没有更多数据！",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $.each(result,function(index,value){
                        if(value.photo.indexOf('null') != -1){
                            value.photo = "../images/default.png";
                        }
                    });
                    $scope.users = result;
                    // 刷新
                    $scope.pageIndex++;
                    $scope.$apply();
                }
            }
        })

    }



});

/*--------------------------------------------------活跃的用户分布*/
app.controller('activeUser', function ($scope,ipCookie) {


    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    $.ajax({
        url:"client.do?method=userArea",
        type:"POST",
        success:function(response){
            var result = response.json;

            var userdata = [];

            $.each(result,function(index,value){
                var temp = {};
                $.each(value,function(key,obj){
                    if(key.indexOf('市') != -1 || key.indexOf('省') != -1){
                        key = key.substring(0,key.length - 1);
                    }
                    else if(key.indexOf('区') != -1){
                        key = key.substring(0,2);
                    }

                    temp["name"] = key;
                    temp["value"] = obj;
                    userdata.push(temp);
                })
            });

            addUserMap(userdata);
        },
        error:function(response){
            swal({
                title:"网络错误!",
                text:"",
                type:"error",
                confirmButtonText:"确认"
            });
        }
    });

});

/*--------------------------------------------------新注册用户的分布*/
app.controller('newUser', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    $(".queryMonth").datetimepicker({
        format: "yyyy-mm-dd",
        language: "zh-CN",
        autoclose: true,
        todayHightlight: true,
        minView: 3,
        startView : 3

    }).on('changeDate',function(e){
        var time = new Date(e.date.valueOf());
        var year = time.getFullYear();
        var month = time.getMonth() + 1;

        $scope.time = year + "年" + month + "月";

        $.ajax({
            url:"client.do?method=userNumber",
            type:"POST",
            data:{"year":year,"month":month},
            success:function(response){
                var result =response.json;

                var x = [];
                var y = [];

                // 遍历数据
                $.each(result,function(index,value){
                    x.push(value["XName"]);
                    y.push(value["userNumber"] || 0);
                });

                newUsersChart($scope.title,$scope.time,x,y);
            }
        });
    })


    $(".queryYear").datetimepicker({
        format: "yyyy-mm-dd",
        language: "zh-CN",
        autoclose: true,
        todayHightlight: true,
        startView : 4,
        minView: 4
    }).on('changeDate',function(e){
        var time = new Date(e.date.valueOf());
        var year = time.getFullYear();
        $scope.time = year + "年";

        $.ajax({
            url:"client.do?method=userNumber",
            type:"POST",
            data:{"year":year,"month":null},
            success: function (response) {
                var result = response.json;

                var x = [];
                var y = [];

                // 遍历数据
                $.each(result,function(index,value){
                    x.push(value["XName"]);
                    y.push(value["userNumber"] || 0);
                });


                newUsersChart($scope.title,$scope.time,x,y);

            }
        });
    })


    // 主要是全国还是哪个店铺(默认全国)
    $scope.title = "全国";

    // 时间
    $scope.time = null;

    // 搜素的时间
    $scope.year = null;
    $scope.month = null;





    // 获取当前的年份

    var nowtime = new Date();
    var nowYear = nowtime.getFullYear();
    $scope.year = nowYear;
    // 读取当前的数据
    $scope.time = $scope.year + "年";

    $.ajax({
        url:"client.do?method=userNumber",
        type:"POST",
        data:{"year":$scope.year,"month":null},
        success: function (response) {
            var result = response.json;

            var x = [];
            var y = [];

            // 遍历数据
            $.each(result,function(index,value){
                x.push(value["XName"]);
                y.push(value["userNumber"] || 0);
            });


            newUsersChart($scope.title,$scope.time,x,y);

        }
    });






});


/*--------------------------------------------------加盟审核*/
app.controller('joinAudit', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    // 状态
    $scope.station = 100;

    // 页数
    $scope.index = 1;

    // 列表
    $scope.joinlist = null;

    // 状态描述
    $scope.stationTitle = ['拒绝','提交中','通过','已清退'];

    // 店铺的类型
    $scope.shopKind = ["乡味优选","特色礼品"];

    // 选择的变化
    $("#bussinessStation").change(function(){
        $scope.station = $(this).val();

        getBussinessList();

    });


    // 获取所有的加盟商
    function getBussinessList(){
        $.ajax({
            url:"bussiness.do?method=bussinessList",
            type:"POST",
            data:{"page":$scope.index,"state":$scope.station},
            success:function(response){
                $scope.joinlist = response.json;
                $scope.$apply();
            },
            error:function(response){
                swal({
                    title:"网络错误！",
                    text:"",
                    type:"error",
                    confirmButtonText:"确定"
                });
            }
        });
    }
    getBussinessList();

    // 2016.10.18 新增商户筛选

    // bussiness_area_filter, bussiness_licenceTime_filter,
	// bussiness_type_filter, bussiness_status_filter, bussiness_name_filter

    function bussiness_filter() {
    	var area = $(".bussiness_area_filter option:selected").val();
    	var type = $(".bussiness_type_filter option:selected").val();
    	var status = $(".bussiness_status_filter option:selected").val();
    	var licenceTime = $(".bussiness_licenceTime_filter").val();
    	var name = $(".bussiness_name_filter").val();

    	console.log(area, type, status, licenceTime, name);

    	var requestData = {
        	"page":$scope.index,
        	"state":$scope.station
        };

    	if(area) {
    		requestData.area = area;
    	}
    	if(type) {
    		requestData.type = type;
    	}
    	if(status) {
    		requestData.status = status;
    	}
    	if(licenceTime) {
    		requestData.licenceTime = licenceTime;
    	}
    	if(name) {
    		requestData.name = name;
    	}

    	$.ajax({
            url:"bussiness.do?method=bussinessList",
            type:"POST",
            data:requestData,
            success:function(response){
                $scope.joinlist = response.json;

                $scope.$apply();
            },
            error:function(response){
                swal({
                    title:"网络错误！",
                    text:"",
                    type:"error",
                    confirmButtonText:"确定"
                });
            }
        });
    }

    // select
    $(".bussiness_area_filter, .bussiness_type_filter, .bussiness_status_filter").on("change",bussiness_filter);

    // input
    $(".bussiness_licenceTime_filter, .bussiness_name_filter").on("blur", bussiness_filter);
    // 前一页
    $scope.pre = function () {
        if($scope.index <= 1) {
            swal({
                title:"已经是第一页了！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.index--;
            $.ajax({
                url:"bussiness.do?method=bussinessList",
                type:"POST",
                data:{
                	"page":$scope.index,
                	"station":$scope.station
                },
                success:function(response){
                    $scope.joinlist = response.json;

                    $scope.$apply();
                },
                error:function(response){
                    swal({
                        title:"网络错误！",
                        text:"",
                        type:"error",
                        confirmButtonText:"确定"
                    });
                }
            });
        }
    }

    // 后一页
    $scope.next = function(){

        $scope.index++;
        $.ajax({
            url:"bussiness.do?method=bussinessList",
            type:"POST",
            data:{"page":$scope.index,"station":$scope.station},
            success:function(response){


                if(response.json.length == 0){
                    $scope.index--;

                    swal({
                        title:"没有更多数据!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.joinlist = response.json;
                    $scope.$apply();
                }
            },
            error:function(response){
                swal({
                    title:"网络错误！",
                    text:"",
                    type:"error",
                    confirmButtonText:"确定"
                });
            }
        });
    }

    // 查看
    $scope.bussinessDetail = null;
    $scope.getMoreIndex = null;
    $scope.getMoreInfo = function(index){

        $scope.getMoreIndex = index;

        $.ajax({
            url:"bussiness.do?method=bussinessInfo",
            type:"POST",
            data:{"bussinessID":$scope.joinlist[index]["bussinessID"]},
            success:function(response){
                var result = response.json;

                $scope.bussinessDetail = result;
                $scope.bussinessDetail.state = $scope.joinlist[index]["state"];
                $scope.$apply();
            }
        });
    }
    $scope.eliminateMer = function(index){

// $scope.getMoreIndex = index;

        $.ajax({
            url:"bussiness.do?method=eliminateMer",
            type:"POST",
            data:{"bussinessID":$scope.joinlist[index]["bussinessID"]},
            success:function(response){
            	swal({
                    title:"清退成功",
                    text:"",
                    type:"info",
                    confirmButtonText:"确定"
                });
            }
        });
    }
    

    // 通过审核
    $scope.audit = function(){
        swal({
                title: "确定通过审核！",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"通过",
                cancelButtonText:"取消"
        },
        function(){
            $.ajax({
                url:"bussiness.do?method=verify",
                type:"POST",
                data:{"bussinessID":$scope.joinlist[$scope.getMoreIndex]["bussinessID"],'result':1,'phone':$scope.bussinessDetail.companyPhone,'account':$scope.userName},
                success:function(response){
                    var tag = response.json;
                    if(tag == 0) {
                        swal({
                            title:"操作失败！",
                            text:"",
                            type:"error",
                            confirmButtonText:"确定"
                        });
                    }
                    else {
                        $scope.joinlist[$scope.getMoreIndex]["account"] = response.json.account;
                        $scope.joinlist[$scope.getMoreIndex]["password"] = response.json.password;
                        $scope.joinlist[$scope.getMoreIndex]["station"] = 1;
                        $scope.$apply();

                        // 发送成功的消息
                        swal({
                            title:"已经给通过申请的商户分配了账号！",
                            text:"",
                            type:"success",
                            confirmButtonText:"确定"
                        });
                    }
                },
                error:function(response){
                    swal({
                        title:"网络错误！",
                        text:"",
                        type:"error",
                        confirmButtonText:"确定"
                    });

                }
            });
        }
        );
    }

    // 拒绝
    $scope.noaudit = function(){
        swal({
                title:"输入拒绝的理由！",
                text:"",
                type:"input",
                showCancelButton:true,
                closeOnConfirm:false,
                animation:"slide-from-top",
                inputPlaceholder:"输入拒绝的理由",
                confirmButtonText:"发送",
                cancelButtonText:"取消",
                showLoaderOnConfirm:true,
        },
            function(inputvalue) {
                if (inputvalue === false) {
                    return false;
                }
                else if (inputvalue === "") {
                    swal.showInputError("你得写一个理由！");
                    return false
                }
                $.ajax({
                    url:"bussiness.do?method=verify",
                    type:"POST",
                    data:{"bussinessID":$scope.joinlist[$scope.getMoreIndex]["bussinessID"],result:-1,"denyReason":inputvalue,'phone':$scope.bussinessDetail.companyPhone,'account':$scope.userName},
                    success:function(response){
                        var tag = response.json;
                        if(tag == 1){
                            swal({
                                title:"已经拒绝加盟!",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });

                            $scope.joinlist[$scope.getMoreIndex]["station"] = -1;

                            $scope.$apply();

                        }
                        else if(tag == 0){
                            swal({
                                title:"操作失败！",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(){
                        swal({
                            title:"网络错误!",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
    );
    }


});

/* ----------------------------------------------- 商家轮播图审核 */
app.controller("auditBussinessBanner",function($scope,ipCookie){

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }


    // 轮播图列表
    $scope.bannerList = null;

    // 状态
    $scope.stationTitle = ["审核失败","等待审核","通过审核"];

    // 列表下标
    $scope.pageIndex = 1;

    function getBannerList(){
        $.ajax({
            url:"activity.do?method=adsList",
            type:'POST',
            data:{"page":$scope.pageIndex}
        })
            .done(function(response){
                var result = response.json;

                $scope.bannerList = result;
                $scope.$apply();
            })
            .fail(function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:'error',
                    confirmButtonText:"确认"
                });
            });
    }

    getBannerList();

    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前已经是第一页！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;
            getBannerList();
        }
    }


    // 后一页
    $scope.next = function(){
        $.ajax({
            url:"activity.do?method=adsList",
            type:'POST',
            data:{"page":$scope.pageIndex + 1}
        })
            .done(function(response){
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多数据!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.bannerList = result;
                    $scope.pageIndex++;
                    $scope.$apply();
                }
            })
            .fail(function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:'error',
                    confirmButtonText:"确认"
                });
            });
    }


    // 审核
    $scope.audit = function(index,station){

        var titleStr = null;
        if(station == 1){
            titleStr = "确认通过审核!";
        }
        else {
            titleStr = "确认拒绝通过!";
        }
        swal({
            title:titleStr,
            text:"",
            type:"info",
            showCancelButton:true,
            closeOnConfirm:false,
            showLoaderOnConfirm:true,
            confirmButtonText:"确认",
            cancelButtonText:"取消"
        },
            function(){
                $.ajax({
                    url:"activity.do?method=adsVerify",
                    type:'POST',
                    data:{"adsID":$scope.bannerList[index]["adsID"],"station":station,'account':$scope.userName}
                })
                    .done(function(response){
                        var tag = response.json;
                        if(tag == 1){
                            swal({
                                title:"操作成功!",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });
                            getBannerList();
                        }
                        else if(tag == -1){
                           swal({
                               title:"操作失败！",
                               text:"",
                               type:"error",
                               confirmButtonText:"确认"
                           });
                        }

                    })
                    .fail(function(){
                        swal({
                            title:"网络错误!",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    });
            }
        );
    }

});

/*--------------------------------------------------商店分账*/
app.controller('payMoney', function ($scope,ipCookie,growl) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }

    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    // 分账的开始时间
    $(".startTime").datetimepicker({
        format: 'yyyy-mm-dd',
        language: 'zh-CN',
        autoclose: true,
        todayHightlight: true,
        minView: 'month'
    });

    $('.startTime').change(function(){

        // 获取到年 月 日

        var timeArray = $('.startTime').val().split('-');
        var year = timeArray[0];
        var month = timeArray[1];
        var day = timeArray[2];
        var dt = new Date(year, month - 1, day);

        var weekday = dt.getDay();
        if(weekday == 1){
            $scope.startTime = $('.startTime').val();

            var endtime = new Date(dt.getTime() + 1209600000);
            $scope.endTime = endtime.getFullYear() + '-' + (endtime.getMonth() + 1 ) + '-' + endtime.getDate();

            var profit = new Date(endtime.getTime() + 1209600000);
            $scope.profitTime = profit.getFullYear() + '-' + (profit.getMonth() + 1 ) + '-' + profit.getDate();

            $scope.$apply();

        }
        else {
            $('.startTime').val('');
            $scope.endTime = null;
            $scope.profitTime = null;
            $scope.$apply();
            swal({
                title:"只能是周一！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
    });

    // 分润的开始时间
    $scope.startTime = null;
    // 分润的结束时间
    $scope.endTime = null;
    // 分润时间
    $scope.profitTime = null;


    // --------------------------------------创建分润期数
    $scope.createProfit = function(){
        if(!$scope.startTime){
            growl.addInfoMessage('请选择分账开始时间！');
        }
        else {
            swal({
                title:'确定建立分账！',
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"
            },
                function(){
                    $.ajax({
                        url:"profit.do?method=addTerm",
                        type:"POST",
                        data:{'startTime':$scope.startTime,'endTime':$scope.endTime,"profitTime":$scope.profitTime},
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:'',
                                    type:'success',
                                    confirmButtonText:'确认'
                                });
                                getTermList();
                            }
                            else if(tag == -1){
                                swal({
                                    title:"操作失败!",
                                    text:'',
                                    type:'error',
                                    confirmButtonText:'确认'
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:'',
                                type:'error',
                                confirmButtonText:'确认'
                            });
                        }
                    });
                }
            );
        }
    }


    // ----------------------------------------获取分账列表
    $scope.termIndex = 1;
    $scope.moneyList = null;

    function getTermList(){
        $.ajax({
            url:"profit.do?method=termList",
            type:"POST",
            data:{'page':$scope.termIndex},
            success:function(response){
                var result = response.json;
                $scope.moneyList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getTermList();

    $scope.termPre = function(){
        if($scope.termIndex == 1){
            swal({
                title:"当前是第一页！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.termIndex--;
            getTermList();
        }
    }
    $scope.termNext = function(){
        $.ajax({
            url:"profit.do?method=termList",
            type:"POST",
            data:{'page':$scope.termIndex + 1},
            success:function(response){
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多数据!",
                        text:"",
                        type:'info',
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.moneyList = result;
                    $scope.termIndex++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }
    // 查看商户列表
    $scope.getBussinessInfo = function(index) {
        $('.bussinessList').css('display','block');
        $('.mainList').css('display','none');
        $('.createTeam').css('display','none');
        $scope.term = $scope.moneyList[index].term;
        var nowtime = new Date().getTime();
        $scope.isShow = nowtime > $scope.moneyList[index].profitTime ? true : false;
        getBussinessList();
    }



    // ----------------------------------获取商家列表
    // 需要查看的期数
    $scope.term = null;
    $scope.bussinessIndex = 1;
    $scope.bussinessList = null;
    $scope.typeTitle = ['乡味优选','特产礼品'];

    function getBussinessList(){
        $.ajax({
            url:"shop.do?method=shopList",
            type:"POST",
            data:{'page':$scope.bussinessIndex,'station':1},
            success:function(response){
                var result = response.json;
                $scope.bussinessList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:'确认'
                });
            }
        });
    }


    $scope.bussinessPre = function(){
        if($scope.bussinessIndex == 1){
            swal({
                title:"当前是第一页!",
                text:"",
                type:'info',
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.bussinessIndex--;
            getBussinessList();
        }
    }
    $scope.bussinessNext = function(){
        $.ajax({
            url:"shop.do?method=shopList",
            type:"POST",
            data:{'page':$scope.bussinessIndex + 1,'station':1},
            success:function(response){
                var result = response.json;
                if(result.length == 0) {
                    swal({
                        title:"没有更多!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.bussinessList = result;
                    $scope.bussinessIndex++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:'确认'
                });
            }
        });
    }
    // 回到分账列表
    $scope.backToMain = function(){
        $('.bussinessList').css('display','none');
        $('.mainList').css('display','block');
        $('.createTeam').css('display','block');
        // 重置到第一页
        $scope.bussinessIndex = 1;
        $scope.term = null;
        $scope.isShow = false;
    }




    // 查看详情
    $scope.getOrderInfo = function(index){
        $('.bussinessList').css('display','none');
        $('.orderList').css('display','block');

        $scope.shopID = $scope.bussinessList[index].shopID;

        getOrderList();

    }

    // 查看分润
    $scope.getProfitInfo = function(index){
        $('.bussinessList').css('display','none');
        $('.profitList').css('display','block');

        $scope.shopID = $scope.bussinessList[index].shopID;

        getProfitList();
    }


    // -----------------------------------------------获取账目清单列表
    // 查看的商家
    $scope.shopID = null;
    $scope.orderList = null;
    $scope.orderListAll = null;
    $scope.orderIndex = 0;
    $scope.num = 20;

    $scope.stationTitle = ['待支付','待发货','待收货','物流确认','买家确认','交易完成','售后退款'];

    function getOrderList(){
        $.ajax({
            url:"order.do?method=orderList",
            type:"POST",
            data:{"shopID":$scope.shopID,'term':$scope.term},
            success:function(response){
                var result = response.json;
                $scope.orderListAll = result;
                $scope.orderList = $scope.orderListAll.slice(0,$scope.num);
                $scope.$apply();

            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    function getProfitList(){
        $.ajax({
            url:"profit.do?method=profitList",
            type:"POST",
            data:{"shopID":$scope.shopID,'term':$scope.term},
            success:function(response){
                var result = response.json;
                $scope.orderListAll = result;
                $scope.orderList = $scope.orderListAll.slice(0,$scope.num);
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    $scope.detailPre = function(){
        if($scope.orderIndex == 0){
            swal({
                title:"当前已经是第一页!",
                text:"",
                type:"info",
                confirmButtonText:"确认"

            });
        }
        else {
            $scope.orderIndex--;
            $scope.orderList = $scope.orderListAll.slice($scope.orderIndex * $scope.num,($scope.orderIndex + 1 ) * $scope.num );
        }
    }
    $scope.detailNext = function(){
        console.log(($scope.orderIndex + 1 ) * $scope.num > $scope.orderListAll.length);
        if(($scope.orderIndex + 1 ) * $scope.num > $scope.orderListAll.length){
            swal({
                title:"没有更多!",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.orderIndex++;
            $scope.orderList = $scope.orderListAll.slice($scope.orderIndex * $scope.num,($scope.orderIndex + 1 ) * $scope.num );
        }
    }

    // 回到商家列表
    $scope.backToBussiness = function(){
        $('.bussinessList').css('display','block');
        $('.orderList').css('display','none');
        $('.profitList').css('display','none');

        $scope.shopID = null;
        $scope.orderIndex = 0;
    }



});


/*--------------------------------------------------商户经营*/
app.controller('bussinessOperation', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    $(".year").datetimepicker({
        format: "yyyy",
        language: "zh-CN",
        autoclose: true,
        todayHightlight: true,
        startView:4,
        minView: 4
    }).on('changeDate', function(ev){
        var year = ev.date.getFullYear();
        getShopData(year, 0);
    });

    $('.month').datetimepicker({
        format: "yyyy-mm",
        language: "zh-CN",
        autoclose: true,
        todayHightlight: true,
        startView: 3,
        minView: 3
    }).on('changeDate', function(ev){
        var year = ev.date.getFullYear();
        var month = ev.date.getMonth() + 1;
        getShopData(year, month);
    });



    /* 查询操作 */

    function getShopData(year, month){
        $.ajax({
            url:'shop.do?method=shopData',
            type:'POST',
            data:{'year':year,'month':month},
            success:function(response){
                var result = response.json;
                var dic = {
                    xArray: [],
                    saleAmount: [],
                    saleMoney: []
                };
                if(month == 0){
                    // 年
                    result.forEach(function(value, index){
                        dic.xArray.push(value.month);
                        dic.saleAmount.push(value.number);
                        dic.saleMoney.push(value.fee);
                    });
                }
                else {
                    // 月
                    result.forEach(function(value, index){
                        dic.xArray.push(value.date);
                        dic.saleAmount.push(value.number);
                        dic.saleMoney.push(value.fee);
                    });
                }

                shopChart(dic);

            },
            error:function(){
                swal({
                    title:"网络错误",
                    text:'',
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }




});


/*--------------------------------------------------给商户发送信息*/
app.controller('sendMessage', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    $scope.bussinessList = null;
    $scope.bussinessIndex = 1;
    $scope.title = null;
    $scope.message = null;
    $scope.targetShop = null;
    $scope.typeTitle = ['乡味优选','特产礼品'];
    // 获取商家列表
    function getBussinessList(){
        $.ajax({
            url:"shop.do?method=shopList",
            type:"POST",
            data:{'page':$scope.bussinessIndex,'station':1},
            success:function(response){
                var result = response.json;
                $scope.bussinessList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:'确认'
                });
            }
        });
    }
    getBussinessList();

    $scope.pre = function(){
        if($scope.bussinessIndex == 1){
            swal({
                title:"当前是第一页!",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.bussinessIndex--;
            getBussinessList();
        }
    }
    $scope.next = function(){
        $.ajax({
            url:"shop.do?method=shopList",
            type:"POST",
            data:{'page':$scope.bussinessIndex + 1,'station':100},
            success:function(response){
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多!",
                        text:"",
                        type:'info',
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.bussinessList = result;
                    $scope.bussinessIndex++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:'确认'
                });
            }
        });
    }
    // 发送消息
    $scope.sendMessage = function(index) {
        $('#sendmessagemodal').modal('show');
        $scope.targetShop = $scope.bussinessList[index].shopID;
    }
    // 群发
    $scope.sendForAll = function(){
        $('#sendmessagemodal').modal('show');
        $scope.targetShop = 0;
    }

    $scope.send = function(){
        if(!$scope.title){

        }
        else if(!$scope.message){

        }
        else {
            $('#sendmessagemodal').modal('hide');
            swal({
                title:"确定发送？",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"
            },
                function(){
                    $.ajax({
                        url:"bussiness.do?method=sendNews",
                        type:"POST",
                        data:{'shopID':$scope.targetShop,'title':$scope.title,"content":$scope.message},
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"操作成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });
                            }
                            else {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        }
                    });
                }
            );
        }
    }



    $scope.cancel = function(){
        $scope.title = null;
        $scope.message = null;
        $scope.targetShop = null;
    }

    $scope.shopName = null;

    $scope.query = function(){
        $.ajax({
            url:"shop.do?method=shopSearch",
            type:"POST",
            data:{'shopName':$scope.shopName || ''},
            success:function(response){
                var result = response.json;
                $scope.bussinessList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:'',
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }



});



/*--------------------------------------------------商户关停*/
app.controller('stopShop', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    // 当前的页数
    $scope.pageIndex = 1;

    // 商店的状态(默认所有的)
    $scope.station = 100;

    // 商店列表
    $scope.bussinessList = null;

    // 商店状态的解释
    $scope.shopStation = ["关停", "营业中"];


    // 商店类型的
    $scope.shopKindText = ["乡味优选", "特产礼品"];


    // 获取商店列表
    function getBussinessList() {
        $.ajax({
            url: "shop.do?method=shopList",
            type: 'POST',
            data: {"page": $scope.pageIndex, "station": $scope.station},
            success: function (response) {
                var result = response.json;
                $.each(result,function(index,value){
                    if(value.shopLogo.indexOf('null') != -1){
                        value.shopLogo = "../images/default.png";
                    }
                });
                $scope.bussinessList = response.json;
                // 刷新数据
                $scope.$apply();
            },
            error: function (response) {
                swal({
                    title: "网络错误!",
                    text: "",
                    type: "error",
                    confirmButtonText: "确认"
                });
            }
        });
    }

    getBussinessList();

    $scope.searchCondition = null;

    // 前一页
    $scope.pre = function () {
        if ($scope.pageIndex == 1) {
            swal({
                title: "已经是第一页了！",
                text: "",
                type: "info",
                confirmButtonText: "确认"
            });
        }
        else {
            $scope.pageIndex--;
            $.ajax({
                url: "shop.do?method=shopList",
                type: "POST",
                data: {"page": $scope.pageIndex, "station": $scope.station},
                success: function (response) {
                    $scope.bussinessList = response.json;

                    // 刷新数据
                    $scope.$apply();
                },
                error: function () {
                    swal({
                        title: '网络错误!',
                        text: "",
                        type: "error",
                        confirmButtonText: "确认"
                    });
                }
            });

        }

        // 后一页
        $scope.next = function () {

            $.ajax({
                url: "shop.do?method=shopList",
                type: "POST",
                data: {"page": $scope.pageIndex + 1, "station": $scope.station},
                success: function (response) {
                    if (response.json.length == 0) {
                        swal({
                            title: "没有更多!",
                            text: "",
                            type: "info",
                            confirmButtonText: "确认"
                        });
                    }
                    else {
                        $scope.bussinessList = response.json;

                        // 刷新数据
                        $scope.$apply();

                        $scope.pageIndex++;
                    }
                },
                error: function (response) {
                    swal({
                        title: "网络错误！",
                        text: "",
                        type: "error",
                        confirmButtonText: "确认"
                    });
                }
            });

        }


        // 查询的条件
        $scope.searchCondition = null;

        // 按照商店名称查询
        $scope.queryShopName = function () {


            if (!$scope.searchCondition) {
                getBussinessList();
            }
            else {
                $.ajax({
                    url: "shop.do?method=shopSearch",
                    type: "POST",
                    data: {"shopName": $scope.searchCondition, "shopArea": null},
                    success: function (response) {

                        $scope.bussinessList = response.json;
                        // 刷新数据
                        $scope.$apply();

                    }
                });
            }


        }

        // 按照授权地区查询
        $scope.queryArea = function () {

            if (!$scope.searchCondition) {
                getBussinessList();
            }
            else {
                $.ajax({
                    url: "shop.do?method=shopSearch",
                    type: "POST",
                    data: {"shopName": null, "shopArea": $scope.searchCondition},
                    success: function (response) {

                        $scope.bussinessList = response.json;

                        // 刷新数据
                        $scope.$apply();

                    }
                });
            }

        }

        // 关停的状态
        $scope.btnStation = ["开启", "关停"];

        // 关停操作
        $scope.stop = function (index) {


            if ($scope.bussinessList[index]["station"] == 1) {
                // 进行关停操作
                swal({
                        title: "您要进行关停操作吗？",
                        text: "",
                        type: "info",
                        showCancelButton: true,
                        closeOnConfirm: false,
                        showLoaderOnConfirm: true,
                        confirmButtonText: "关停",
                        cancelButtonText: "取消"
                    },
                    function () {

                        $.ajax({
                            url: "shop.do?method=shopStop",
                            type: "POST",
                            data: {"shopID": $scope.bussinessList[index]["shopID"], "station": -1},
                            success: function (response) {
                                var tag = response.json;
                                if (tag == 1) {
                                    swal({
                                        title: "关停成功!",
                                        text: "",
                                        type: "success",
                                        confirmButtonText: "确认"
                                    });

                                    $scope.bussinessList[index]["station"] = -1;

                                    // 刷新数据
                                    $scope.$apply();
                                }
                                else {
                                    swal({
                                        title: "关停失败!",
                                        text: "",
                                        type: "error",
                                        confirmButtonText: '确认'
                                    });

                                }
                            },
                            error: function (response) {
                                swal({
                                    title: "网络错误!",
                                    text: "",
                                    type: "error",
                                    confirmButtonText: "确认"
                                });
                            }
                        });
                    }
                );

            }
            else {

                // 进行开启操作
                swal({
                        title: "您要进行开启操作吗？",
                        text: "",
                        type: "info",
                        showCancelButton: true,
                        closeOnConfirm: false,
                        showLoaderOnConfirm: true,
                        confirmButtonText: "开启",
                        cancelButtonText: "取消"
                    },
                    function () {

                        $.ajax({
                            url: "shop.do?method=shopStop",
                            type: "POST",
                            data: {"shopID": $scope.bussinessList[index]["shopID"], "station": 1},
                            success: function (response) {
                                var tag = response.json;
                                if (tag == 1) {
                                    swal({
                                        title: "开启成功！",
                                        text: "",
                                        type: "success",
                                        confirmButtonText: "确认"
                                    });

                                    $scope.bussinessList[index]["station"] = 1;

                                    // 刷新数据
                                    $scope.$apply();
                                }
                                else {
                                    swal({
                                        title: '开启失败！',
                                        text: "",
                                        type: "error",
                                        confirmButtonText: "确认"
                                    });
                                }
                            },
                            error: function (response) {
                                swal({
                                    title: "网络错误!",
                                    text: "",
                                    type: "error",
                                    confirmButtonText: "确认"
                                });
                            }
                        });
                    }
                );

            }


        }

        // 关停全平台
        $scope.stopAll = function () {
            var len = $scope.shops.length;
            for (var i = 0; i < len; i++) {
                $scope.shops[i]['status'] = "已经关停";
            }
        }

    }

    // 后一页
    $scope.next = function(){
        $.ajax({
            url: "shop.do?method=shopList",
            type: 'POST',
            data: {"page": $scope.pageIndex, "station": $scope.station},
            success: function (response) {
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多数据!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $.each(result,function(index,value){
                        if(value.shopLogo.indexOf('null') != -1){
                            value.shopLogo = "../images/default.png";
                        }
                    });
                    $scope.bussinessList = response.json;
                    $scope.pageIndex++;
                    // 刷新数据
                    $scope.$apply();
                }
            },
            error: function (response) {
                swal({
                    title: "网络错误!",
                    text: "",
                    type: "error",
                    confirmButtonText: "确认"
                });
            }
        });
    }

    $scope.query = function(){
        $.ajax({
            url:"shop.do?method=shopSearch",
            type:"POST",
            data:{'shopName':$scope.searchCondition || ''},
            success:function(response){
                var result = response.json;
                $scope.bussinessList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:'',
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }

    $scope.stop = function(index){
        shopOpen(index,-1);
    }

    $scope.open = function(index){
        shopOpen(index,1);
    }


    function shopOpen(index, station) {
        var title;
        if(station === 1){
            title = "您要进行开启操作吗？";
        }
        else {
            title = "您要进行关停操作吗？";
        }

        swal({
                title:title,
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"

            },
            function(){
                $.ajax({
                    url:"shop.do?method=shopStop",
                    type:'POST',
                    data:{"shopID":$scope.bussinessList[index].shopID,"station":station,'account':$scope.userName},
                    success:function(response){
                        if(response.json == 1){
                            swal({
                                title:"操作成功!",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });
                            $scope.bussinessList[index]["station"] = station;

                            // 刷新
                            $scope.$apply();
                        }
                        else {
                            swal({
                                title:"操作失败！",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(response){
                        swal({
                            title:'网络错误！',
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
        );
    }
});


/*--------------------------------------------------商品下架*/
app.controller('stopGoods', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    // 当前的页数
    $scope.pageIndex = 1;

    // 默认状态所有的商品
    $scope.station = 200;

    // 商品列表
    $scope.goodList = null;

    // 状态
    $scope.stationTitle = ["口味零食","老家食材",'时令果蔬','特产食品',"工艺臻品"];

    // 获取商品列表
    function getGoodList(){
        $.ajax({
            url:"goods.do?method=goodsList",
            type:'POST',
            data:{"page":$scope.pageIndex,"station":$scope.station},
            success:function(response){

                $scope.goodList = response.json;

                // 刷新数据
                $scope.$apply();
            },
            error:function(response){
                swal({
                    title:"网络错误",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }
    getGoodList();

    // 前一页
    $scope.pre = function(){

        if($scope.pageIndex == 1) {
            swal({
                title:"当前已经是第一页！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {

            $scope.pageIndex--;

            $.ajax({
                url:"goods.do?method=goodsList",
                type:'POST',
                data:{"page":$scope.pageIndex,"station":$scope.station},
                success:function(response){

                    $scope.goodList = response.json;

                    // 刷新数据
                    $scope.$apply();
                },
                error:function(response){
                    swal({
                        title:"网络错误!",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                    });
                }
            });

        }

    }


    // 后一页
    $scope.next = function(){

        $.ajax({
            url:"goods.do?method=goodsList",
            type:"POST",
            data:{"page":$scope.pageIndex + 1,"station":$scope.station},
            success:function(response){

                if(response.json.length == 0){
                    swal({
                        title:"没有更多!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {

                    $scope.goodList = response.json;
                    $scope.pageIndex++;
                    // 刷新数据
                    $scope.$apply();


                }
            },
            error:function(response){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    $scope.searchCondition = null;

    $scope.query = function(){
        $.ajax({
            url:"goods.do?method=goodsSearchByName",
            type:"POST",
            data:{"goodsName":$scope.searchCondition || ''},
            success:function(response){
                var result = response.json;
                $scope.goodList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误！",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    // 单个下架
    $scope.stop = function (index) {

        swal({
                title:"您要进行下架操作吗？",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"

        },
        function(){
            $.ajax({
                url:"goods.do?method=goodsVerify",
                type:'POST',
                data:{"goodsID":$scope.goodList[index]["goodsID"],"station":-2},
                success:function(response){
                    if(response.json == 1){
                        swal({
                            title:"下架成功!",
                            text:"",
                            type:"success",
                            confirmButtonText:"确认"
                        });
                        $scope.goodList[index]["station"] = -2;

                        // 刷新
                        $scope.$apply();
                    }
                    else {
                        swal({
                            title:"下架失败！",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                },
                error:function(response){
                    swal({
                        title:'网络错误！',
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                    });
                }
            });
        }
        );
    }

    // 上架
    $scope.open = function(index){
        swal({
                title:"您要进行上架操作吗？",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"

            },
            function(){
                $.ajax({
                    url:"goods.do?method=goodsVerify",
                    type:'POST',
                    data:{"goodsID":$scope.goodList[index]["goodsID"],"station":1},
                    success:function(response){
                        if(response.json == 1){
                            swal({
                                title:"上架成功!",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });
                            $scope.goodList[index]["station"] = 1;
                            // 刷新
                            $scope.$apply();
                        }
                        else {
                            swal({
                                title:"上架失败！",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(response){
                        swal({
                            title:'网络错误！',
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
        );
    }



});

/*--------------------------------------------------商品投诉次数*/
app.controller('complaintGoods', function ($scope,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    $scope.stationTitle = ["口味零食","老家食材",'时令果蔬','特产食品',"工艺臻品"];

    $scope.goods = null;
    $scope.page = 1;

    function getList(){
        $.ajax({
            url:"goods.do?method=refundList",
            type:'POST',
            data:{'page':$scope.page},
            success:function(response){
                $scope.goods = response.json;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:'网络错误',
                    text:'',
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getList();
    $scope.pre = function(){
        if($scope.page == 1){
            swal({
                title:"当前已经是第一页!",
                text:'',
                type:'info',
                confirmButtonText:'确认'
            });
        }
        else {
            $scope.page--;
            getList();
        }
    }

    $scope.next = function(){
        $.ajax({
            url:"goods.do?method=refundList",
            type:'POST',
            data:{'page':$scope.page + 1},
            success:function(response){
                var result = response.json;

                if(result.length == 0){
                    swal({
                        title:'没有更多!',
                        text:"",
                        type:'info',
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.goods = response.json;
                    $scope.page++;
                    $scope.$apply();
                }

            },
            error:function(){
                swal({
                    title:'网络错误',
                    text:'',
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }
});


/*--------------------------------------------------今日订单*/
app.controller('orderList', function ($scope, ipCookie, $http) {
    $scope.userName = ipCookie("userName");
//    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
//    $scope.stationTitle = ['待支付','待发货','待收货','物流确认','买家确认','交易完成','售后退款','退款结束'];
    $scope.orders = null;
    $scope.pageIndex = 1;
    $scope.loading = false;
    $scope.notLoading = true;
    
    //下拉筛选
	$scope.data = {
	   availableOptions: [
	     {state: -1, name: '全部'},
		 {state: 0, name: '已取消'},
		 {state: 1, name: '待支付'},
		 {state: 2, name: '待发货'},
		 {state: 3, name: '待收货'},
		 {state: 4, name: '物流确认'},
		 {state: 5, name: '买家确认'},
		 {state: 6, name: '交易完成'},
		 {state: 7, name: '售后退款'},
		 {state: 8, name: '退款结束'},
		 {state: 9, name: '待定'},
		 {state: 10, name: '交易结束'}
	   ],
	   selectedOption: {state: -1, name: '全部'} //设置默认值
	};

    // 获取订单
    $scope.submit = function() {

    	getOrderList();

    }

    function getOrderList() {

//	$.ajax({
//	      url:"order.do?method=todayOrder",
//	      type:'POST',
//	      data:{"page":$scope.pageIndex},
//	      success:function(response){
//	        response = "{\"json\":[{\"couponFee\":0,\"wxFee\":179,\"orderID\":10008936,\"logiFee\":\"1.0\",\"fee\":179,\"transactionNumber\":\"4005682001201702119505948929\",\"congratulations\":\"\",\"show\":0,\"shopName\":\"龙湾区乡味特产自营店\",\"zfbFee\":0,\"message\":\"\",\"userID\":1003388,\"transactionType\":6,\"pin\":0,\"giftcardFee\":0,\"opTime\":1486776454408,\"profitOperation\":0,\"station\":3,\"invoice\":\"\",\"shopID\":43}]}";
//	        var result = response.json;
//	        var result = [{shopName:'龙湾区乡味特产自营店',zfbFee:0}];
//	      	$scope.orders = result;
//	      	alert($scope.orders);
//	      	alert($scope.orders[0]);
//	        $scope.$apply();
//	      },
//	      error:function(){
//	          swal({
//	              title:"网络错误!",
//	              text:"",
//	              type:"error",
//	              confirmButtonText:'确认'
//	          });
//	      }
//	  });
    var data = "page=" + $scope.pageIndex + "&a=2&state=" + $scope.data.selectedOption.state;
    if ($scope.startDate) {
    	data += "&startDate=" + $scope.startDate;
    }
    
    if ($scope.endDate) {
    	data += "&endDate=" + $scope.endDate;
    }
    
    console.log("data: " + data);
    $scope.loading = true;
    $scope.notLoading = false;
	$http({  
		method: 'POST',
		url: 'order.do?method=orderListGet',
		headers: {
			'Content-Type':  "application/x-www-form-urlencoded"
		},
		data 
	}).then(function successCallback(response) {
        $scope.loading = false;
        $scope.notLoading = true;
		var result = response.data.data.orderList;
		console.log("response: ", response);
//		var result = [{shopName:'龙湾区乡味特产自营店',zfbFee:0}];
		$scope.orders = result;
		$scope.totalNum = response.data.data.count;
		if($scope.totalNum == 0){
			$scope.totalPageNum = 1;
		} else {
			$scope.totalPageNum = Math.ceil($scope.totalNum / 20);
		}
		console.log("orders: " + $scope.orders);
		console.log("totalPageNum: " + $scope.totalPageNum);
//		$scope.$apply();
	  }, function errorCallback(response) {
			$scope.loading = false;
			$scope.notLoading = true;
			swal({
			    title:"网络错误!",
				  text:"",
				  type:"error",
				  confirmButtonText:'确认'});
			});
    }
    
    getOrderList();

    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前已经是第一页了!",
                text:"",
                type:'info',
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;
            getOrderList();
        }
    }

    // 后一页
    $scope.next = function(){
    	$scope.pageIndex += 1;
    	getOrderList();
//        $.ajax({
//            url:"order.do?method=todayOrder",
//            type:'POST',
//            data:{"page":$scope.pageIndex + 1},
//            success:function(response){
//                var result = response.json;
//                if(result.length == 0){
//                    swal({
//                        title:"没有更多!",
//                        text:"",
//                        type:"info",
//                        confirmButtonText:"确认"
//                    });
//                }
//                else {
//                    $scope.orders = result;
//                    $scope.pageIndex++;
//                    $scope.$apply();
//                }
//            },
//            error:function(){
//                swal({
//                    title:"网络错误!",
//                    text:"",
//                    type:"error",
//                    confirmButtonText:'确认'
//                });
//            }
//        });
    }
});

app.controller('packageOrderList', function ($scope, ipCookie, $http) {
    $scope.userName = ipCookie("userName");
//    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    
    $scope.orders = null;
    $scope.pageIndex = 1;
    $scope.loading = false;
    $scope.notLoading = true;

    // 获取订单
    $scope.submit = function() {

    	getOrderList();

    }

    function getOrderList() {
    var data = "page=" + $scope.pageIndex + "&a=2";
    if ($scope.startDate) {
    	data += "&startDate=" + $scope.startDate;
    }
    
    if ($scope.endDate) {
    	data += "&endDate=" + $scope.endDate;
    }
    
    console.log("data: " + data);
    $scope.loading = true;
    $scope.notLoading = false;
	$http({  
		method: 'POST',
		url: 'order.do?method=packageOrderListGet',
		headers: {
			'Content-Type':  "application/x-www-form-urlencoded"
		},
		data 
	}).then(function successCallback(response) {
        $scope.loading = false;
        $scope.notLoading = true;
		var result = response.data.data.orderList;
		console.log("response: ", response);
		$scope.orders = result;
		$scope.totalNum = response.data.data.count;
		if($scope.totalNum == 0){
			$scope.totalPageNum = 1;
		} else {
			$scope.totalPageNum = Math.ceil($scope.totalNum / 20);
		}
//		$scope.$apply();
	  }, function errorCallback(response) {
			$scope.loading = false;
			$scope.notLoading = true;
			swal({
			    title:"网络错误!",
				  text:"",
				  type:"error",
				  confirmButtonText:'确认'});
			});
    }
    
    getOrderList();

    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前已经是第一页了!",
                text:"",
                type:'info',
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;
            getOrderList();
        }
    }

    // 后一页
    $scope.next = function(){
    	$scope.pageIndex += 1;
    	getOrderList();
    }
});

/*--------------------------------------------------特权订单*/
app.controller('privilegeOrderList', function ($scope, ipCookie, $http) {
    $scope.userName = ipCookie("userName");
//    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
//    $scope.stationTitle = ['待支付','待发货','待收货','物流确认','买家确认','交易完成','售后退款','退款结束'];
    $scope.orders = null;
    $scope.pageIndex = 1;
    $scope.loading = false;
    $scope.notLoading = true;
    
    //下拉筛选
	$scope.data = {
	   availableOptions: [
	     {state: -1, name: '全部'},
		 {state: 0, name: '已取消'},
		 {state: 1, name: '待支付'},
		 {state: 2, name: '待发货'},
		 {state: 3, name: '待收货'},
		 {state: 4, name: '物流确认'},
		 {state: 5, name: '买家确认'},
		 {state: 6, name: '交易完成'},
		 {state: 7, name: '售后退款'},
		 {state: 8, name: '退款结束'},
		 {state: 9, name: '待定'},
		 {state: 10, name: '交易结束'}
	   ],
	   selectedOption: {state: -1, name: '全部'} //设置默认值
	};

    // 获取订单
    $scope.submit = function() {

    	getOrderList();

    }

    function getOrderList() {

//	$.ajax({
//	      url:"order.do?method=todayOrder",
//	      type:'POST',
//	      data:{"page":$scope.pageIndex},
//	      success:function(response){
//	        response = "{\"json\":[{\"couponFee\":0,\"wxFee\":179,\"orderID\":10008936,\"logiFee\":\"1.0\",\"fee\":179,\"transactionNumber\":\"4005682001201702119505948929\",\"congratulations\":\"\",\"show\":0,\"shopName\":\"龙湾区乡味特产自营店\",\"zfbFee\":0,\"message\":\"\",\"userID\":1003388,\"transactionType\":6,\"pin\":0,\"giftcardFee\":0,\"opTime\":1486776454408,\"profitOperation\":0,\"station\":3,\"invoice\":\"\",\"shopID\":43}]}";
//	        var result = response.json;
//	        var result = [{shopName:'龙湾区乡味特产自营店',zfbFee:0}];
//	      	$scope.orders = result;
//	      	alert($scope.orders);
//	      	alert($scope.orders[0]);
//	        $scope.$apply();
//	      },
//	      error:function(){
//	          swal({
//	              title:"网络错误!",
//	              text:"",
//	              type:"error",
//	              confirmButtonText:'确认'
//	          });
//	      }
//	  });
    var data = "page=" + $scope.pageIndex + "&a=2&state=" + $scope.data.selectedOption.state;
    if ($scope.startDate) {
    	data += "&startDate=" + $scope.startDate;
    }
    
    if ($scope.endDate) {
    	data += "&endDate=" + $scope.endDate;
    }
    
    console.log("data: " + data);
    $scope.loading = true;
    $scope.notLoading = false;
	$http({  
		method: 'POST',
		url: 'order.do?method=privilegeOrderListGet',
		headers: {
			'Content-Type':  "application/x-www-form-urlencoded"
		},
		data 
	}).then(function successCallback(response) {
        $scope.loading = false;
        $scope.notLoading = true;
		var result = response.data.data.orderList;
		console.log("response: ", response);
//		var result = [{shopName:'龙湾区乡味特产自营店',zfbFee:0}];
		$scope.orders = result;
		$scope.totalNum = response.data.data.count;
		if($scope.totalNum == 0){
			$scope.totalPageNum = 1;
		} else {
			$scope.totalPageNum = Math.ceil($scope.totalNum / 20);
		}
		console.log("orders: " + $scope.orders);
		console.log("totalPageNum: " + $scope.totalPageNum);
//		$scope.$apply();
	  }, function errorCallback(response) {
			$scope.loading = false;
			$scope.notLoading = true;
			swal({
			    title:"网络错误!",
				  text:"",
				  type:"error",
				  confirmButtonText:'确认'});
			});
    }
    
    getOrderList();

    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前已经是第一页了!",
                text:"",
                type:'info',
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;
            getOrderList();
        }
    }

    // 后一页
    $scope.next = function(){
    	$scope.pageIndex += 1;
    	getOrderList();
//        $.ajax({
//            url:"order.do?method=todayOrder",
//            type:'POST',
//            data:{"page":$scope.pageIndex + 1},
//            success:function(response){
//                var result = response.json;
//                if(result.length == 0){
//                    swal({
//                        title:"没有更多!",
//                        text:"",
//                        type:"info",
//                        confirmButtonText:"确认"
//                    });
//                }
//                else {
//                    $scope.orders = result;
//                    $scope.pageIndex++;
//                    $scope.$apply();
//                }
//            },
//            error:function(){
//                swal({
//                    title:"网络错误!",
//                    text:"",
//                    type:"error",
//                    confirmButtonText:'确认'
//                });
//            }
//        });
    }
});


/* -------------------- 开通热门城市-------------------------------- */

app.controller('openCity', function ($scope,growl,ipCookie) {

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    $scope.companyProvince = null;
    $scope.companyCity = null;
    $scope.companyCounty = null;

    $("#cityArea").selectCity({
        btn_width:20,
        btn_height:20,
        jsonaddress:'../json/cityData.min.json'
    },function(a,b,c){
        // 获得选择的城市
        $("#cityArea").val(a+b+(c || ""));

        $scope.companyProvince = a;
        $scope.companyCity = b;
        $scope.companyCounty = c;

    });

    $("#cityImage").change(function(){
        var imgsize = $(this).prop("files")[0].size / 1024 / 1024;

        if(imgsize > 1){
            swal({
                title:"图片的大小超过1M",
                text:"",
                type:"info",
                confirmButonText:"确认"
            });

            $(this).val("");
        }
    });



    // 城市列表
    $scope.cities = null;

    // 当前的页数
    $scope.pageIndex = 1;

    function getList(){
        $.ajax({
            url:'system.do?method=hotCityList',
            type:'POST',
            data:{"page":$scope.pageIndex},
            success:function(response){
                $scope.cities = response.json;
                console.log(response.json);
                // 刷新数据
                $scope.$apply();
            }
        });
    }

    getList();

    // 修改
    $scope.updateWeight = function(index){
        swal({
                title:"修改优先级！",
                text:"",
                type:"input",
                showCancelButton:true,
                closeOnConfirm:false,
                animation:"slide-from-top",
                inputPlaceholder:"输入比重",
                confirmButtonText:"修改",
                cancelButtonText:"取消"
            },
            function(inputvalue) {

                var reg = new RegExp("^[0-9]*$");
                if (inputvalue === false) {
                    return false;
                }
                else if (inputvalue === "") {
                    swal.showInputError("输入一个数字");
                    return false;
                }
                else if(!reg.test(inputvalue)) {
                    swal.showInputError("请输入数字")
                }
                else {
                    $.ajax({
                        url:"system.do?method=hotCityWeight",
                        type:"POST",
                        data:{cityID:$scope.cities[index]["cityID"],weight:inputvalue},
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"修改成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                $scope.cities[index]["weight"] = inputvalue;

                                // 刷新
                                $scope.$apply();
                            }
                            else if(tag == 0) {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:'确认'
                                });
                            }
                        },
                        error:function(response){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:'确认'
                            });
                        }
                    });

                }
            }
        );
    }


    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前已经是第一页！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;

            $.ajax({
                url:"system.do?method=hotCityList",
                type:"POST",
                data:{"page":$scope.pageIndex},
                success:function(response){
                    $scope.pageIndex = response.json;

                    // 刷新数据
                    $scope.$apply();
                }
            });
        }
    }

    // 后一页
    $scope.next = function(){

        $.ajax({
            url:"system.do?method=hotCityList",
            type:"POST",
            data:{"page":$scope.pageIndex},
            success:function(response){

                if(response.json.length == 0) {
                    swal({
                        title:"没有更多！",
                        text:'',
                        type:"info",
                        cnfirmButtonText:"确认"
                    });
                }
                else {
                    $scope.cities = response.json;

                    $scope.pageIndex++;

                    // 刷新数据
                    $scope.$apply();
                }
            }
        });
    }

    $scope.recommendEventText = ['推荐城市','取消推荐'];
    // 推荐文案
    $scope.recommend = ['否','是'];
    // 推荐城市
    $scope.recommendCity = function(id, status){
    	status = status == 1 ? 0 : 1;
    	var title = status == 1 ? "您要推荐此城市至首页？" : "是否取消城市推荐？";
    	swal({
            title:title,
            text:"",
            type:"info",
            showCancelButton:true,
            closeOnConfirm:false,
            showLoaderOnConfirm:true,
            confirmButtonText:"确认",
            cancelButtonText:"取消"
        },
        function(){
            $.ajax({
                url:"system.do?method=hotCityRecommend",
                type:"POST",
                data:{
                	cityID : id,
                	recommend : status
                },
                dataType:"json",
                success: function (response) {
                    if(response.code == 1){
                        swal({
                            title:"操作成功",
                            type:"success",
                            confirmButtonText:"确认"
                        });
                        // 刷新
                        getList();
                        $("#cityImage").val("");
                    }
                    else if(response.code == -1) {
                        swal({
                            title:"操作失败！",
                            text:"",
                            type:"info",
                            confirmButtonText:"确认"
                        });
                    }
                },
                error:function(response){
                    swal({
                        title:"网络错误!",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                    });
                }
            });
        }
        );
    }
    // 开通城市
    $scope.openCity = function(){

        if(!$("#cityImage").val()){
            growl.addWarnMessage("没有选择图片!");
        } else if(!$scope.companyCity) {
            growl.addWarnMessage("没有选择开通的城市！");
        } else {
            var form = new FormData();
            form.append("cityPicture",$("#cityImage").prop("files")[0]);
            form.append("province",$scope.companyProvince);
            form.append("city",$scope.companyCity);
            if($scope.companyCounty){
            	form.append("county",$scope.companyCounty);
            }
            form.append('account',$scope.userName);
            // form.append("isRecommend", $(".isRecommend
			// option:selected").val());

            swal({
                title:"您要开通此城市吗？",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"
            },
            function(){
                $.ajax({
                    url:"system.do?method=hotCity",
                    type:"POST",
                    data:form,
                    contentType: false,
                    processData: false,
                    success: function (response) {
                        if(response.json == 1){
                            swal({
                                title:"开通成功！",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });
                            // 刷新
                            getList();
                            $("#cityImage").val("");
                        }
                        else if(response.json == 0){
                            swal({
                                title:"此城市已经添加!",
                                text:"",
                                type:"info",
                                confirmButtonText:"确认"
                            });
                        }
                        else if(response.json == -1) {
                            swal({
                                title:"开通失败！",
                                text:"",
                                type:"info",
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(response){
                        swal({
                            title:"网络错误!",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
            );
        }
    }



});

/* -------------------------- 管理首页轮播图 ---------------------------------------- */
app.controller('indexBanner',function($scope,growl,ipCookie){

    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');

    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }


    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }


    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }

    // 默认为APP类型
    $scope.bannerType = 0;

    $("#typeSelectInput").on("change",function(){
		$scope.bannerType = $(this).find("option:selected").val()
		$scope.$apply();
		console.log($scope.bannerType);
		getBannerList();
	});

    // 图片
    $scope.banner = null;
    $('#indexBanner').change(function(){
        var imgsize = $(this).prop("files")[0].size / 1024 / 1024;
        if(imgsize < 1){
            $scope.banner = $(this).prop("files")[0];
        }
        else {
            swal({
                title:"图片的大小超过1M!",
                text:'',
                type:'info',
                confirmButtonText:"确认"
            });

            $(this).val("");
        }

        $scope.$apply();
    });

    // 页数
    $scope.pageIndex = 1;

    // 获取轮播图列表
    function getBannerList(){
        $.ajax({
            url:"system.do?method=adsList",
            type:"POST",
            data:{
              "page":$scope.pageIndex,
        	  "type":$scope.bannerType
        	},
            success:function(response){
                var result = response.json;
                console.log(document.domain, location.port);
                var port = "";
                var replacedUrl = "";
                if(location.port) {
                	port = ":" + location.port;
                }
                replacedUrl = "http://" + document.domain + port + "/";
                for(var i=0;i<result.length;i++) {
                	result[i].picture = result[i].picture.replace("http://115.28.57.124:8080/", replacedUrl);
                }
                $scope.banners = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getBannerList();

    // 链接地址
    $scope.bannerURL = null;

    // 修改
    $scope.update = function(index){
        swal({
                title:"修改优先级！",
                text:"",
                type:"input",
                showCancelButton:true,
                closeOnConfirm:false,
                animation:"slide-from-top",
                inputPlaceholder:"输入比重",
                confirmButtonText:"修改",
                cancelButtonText:"取消"
            },
            function(inputvalue) {

                var reg = new RegExp("^[0-9]*$");
                if (inputvalue === false) {
                    return false;
                }
                else if (inputvalue === "") {
                    swal.showInputError("输入一个数字");
                    return false;
                }
                else if(!reg.test(inputvalue)) {
                    swal.showInputError("请输入数字")
                }
                else {
                    $.ajax({
                        url:"system.do?method=adsWeight",
                        type:"POST",
                        data:{"opTime":$scope.banners[index].opTime,"weight":inputvalue},
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"修改成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                $scope.banners[index].weight = inputvalue;

                                // 刷新
                                $scope.$apply();
                            }
                            else if(tag == 0) {
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:'确认'
                                });
                            }
                        },
                        error:function(response){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:'确认'
                            });
                        }
                    });

                }
            }
        );
    }

    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前已经是第一页了!",
                text:"",
                type:'info',
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;
            getBannerList();
        }
    }

    $scope.next = function(){
        $.ajax({
            url:"system.do?method=adsList",
            type:"POST",
            data:{"page":$scope.pageIndex + 1},
            success:function(response){
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多数据!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });

                }
                else {
                    $scope.banners = result;
                    $scope.pageIndex++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }
    // 添加banner
    $scope.addBanner = function(){


        if(!$scope.banner) {
            growl.addInfoMessage("请选择图片！");
        }
        else {

            var formdata = new FormData();

            formdata.append("picture",$scope.banner);
            formdata.append("type",$scope.bannerType);
            if($scope.bannerURL){
                formdata.append("url",$scope.bannerURL);
            }
            formdata.append('account',$scope.userName);
            swal({
                title:"确定上传轮播图？",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"

            },
                function(){
                    $.ajax({
                        url:"system.do?method=ads",
                        type:"POST",
                        data:formdata,
                        contentType: false,
                        processData: false,
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"上传成功！",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                $scope.bannerURL = null;
                                $scope.banner = null;
                                $('#indexBanner').val("");
                                getBannerList();
                            }
                            else if(tag == -1){
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );
        }

    }


    // 删除轮播图
    $scope.remove = function(index){
        swal({
                title:"确定删除轮播图？",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"

            },
            function(){

                $.ajax({
                    url:"system.do?method=adsDel",
                    type:"POST",
                    data:{'opTime':$scope.banners[index].opTime},
                    success:function(response){
                        var tag = response.json;
                        if(tag == 1){
                            swal({
                                title:"删除成功！",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });
                            getBannerList();
                        }
                        else if(tag == -1){
                            swal({
                                title:"删除失败!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(){
                        swal({
                            title:"网络错误!",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
        );
    }

})

/* -------------------------- 活动管理 ---------------------------------------- */
app.controller('auditActivity',function($scope,ipCookie,growl){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 活动的时间
    $(".activityTime").datetimepicker({
        format: "yyyy-mm-dd",
        language: "zh-CN",
        autoclose: true,
        todayHightlight: true,
        minView: "month"
    })


    $(".activityDetailStartTime").datetimepicker({
        format: "yyyy-mm-dd hh:ii",
        language: "zh-CN",
        autoclose: true,
        todayHightlight: true,
    })

    $(".activityDetailEndTime").datetimepicker({
        format: "yyyy-mm-dd hh:ii",
        language: "zh-CN",
        autoclose: true,
        todayHightlight: true,
    })


    // 开始时间
    $scope.activityDetailStartTime = null;
    // 结束时间
    $scope.activityDetailEndTime = null;

    // 查询时间
    $scope.searchTime = getymd();

    // 默认为今天

    $(".activityTime").val(getymd());

    $(".activityTime").change(function(){
        $scope.searchTime = $(this).val();

        // 选取商品的列表清空
        $scope.goodsList = [];
        $scope.$apply();

        getActivityList();
    });


    // 获取活动列表
    $scope.activityList = [];
    // 活动详情商品
    $scope.activityDetail = [];
    // 商家列表
    $scope.shopList = [];
    // 选取商品的列表
    $scope.goodsList = [];
    // 活动商品列表
    $scope.chooseGoodsList = [];

    // 获取活动列表
    function getActivityList(){
        $.ajax({
            url:"activity.do?method=activityList",
            type:"POST",
            data:{"time":$scope.searchTime},
            success:function(response){
                var result = response.json;
                console.log(result);
                $scope.activityList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    // 查看活动详情
    $scope.getActivityGoods = function(index){
        $.ajax({
            url:"activity.do?method=activityContent",
            type:"POST",
            data:{"activityID":$scope.activityList[index]['activityID']},
            success:function(response){
                var result = response.json;
                $scope.activityDetail = result;
                $scope.$apply();
                $('#activityDetail').modal('show');
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getActivityList();

    // 活动申请商家的页数
    $scope.bussinessPage = 1;

    // 获取活动申请的商家
    function getActivityBussiness(){
        $.ajax({
                url:"activity.do?method=activityApplicationList",
                type:"POST",
                data:{"time":$scope.searchTime,"page":$scope.bussinessPage},
                success:function(response){
                var result = response.json;
                $scope.shopList = result;
                $scope.$apply();
            },
                error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    // 前一页
    $scope.shopPre = function(){
        if($scope.bussinessPage == 1){
            swal({
                title:"当前已经是第一页了！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.bussinessPage--;
            getActivityBussiness();
        }
    }

    // 后一页
    $scope.shopNext = function(){
        $.ajax({
            url:"activity.do?method=activityApplicationList",
            type:"POST",
            data:{"time":$scope.searchTime,"page":$scope.bussinessPage + 1},
            success:function(response){
                var result = response.json;

                if(result.length == 0) {
                    swal({
                        title:"没有更多数据！",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.shopList = result;
                    $scope.bussinessPage++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    // 获取具体商家的商品
    $scope.shopDetail = function(index){

        $.ajax({
            url:"activity.do?method=activityApplicationContent",
            type:"POST",
            data:{"applicationID":$scope.shopList[index]['applicationID']},
            success:function(response){
                var result = response.json;
                $scope.goodsList = result;
                console.log(result);
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }


    // 选择活动商品
    $scope.chooseGood = function(index){
        var tempid = $scope.goodsList[index]['goodsID'];
        var flag = true;
        var targetIndex = -1;
        $.each($scope.chooseGoodsList,function(index, value){
            if(value.goodsID == tempid){
                flag = false;
                targetIndex = index;
            }
        });

        if(!flag){
            $scope.chooseGoodsList.splice(targetIndex,1);
        }
        else {
            $scope.chooseGoodsList.push($scope.goodsList[index]);
        }
    }


    // 点击开启活动
    $scope.startActivity = function(){
        getActivityBussiness();
        $("#activityGoodsList").modal('show');
    }

    // 获得时间列表
    $scope.getTimeInfo = function(){
        if($scope.chooseGoodsList.length > 0){
            getTime();
        }
    }

    // 分配时间
    function getTime(){
        // 查看当天可用时间段
        $.ajax({
            url:"activity.do?method=validTime",
            type:"POST",
            data:{"time":$scope.searchTime},
            success:function(response){
                var result = response.json;
                $scope.timeList = result;
                $scope.$apply();
                console.log(result);
                $("#auditDetail").modal("show");
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });

    }

    // 选择时间段
    $scope.chooseTime = function(index){
        if($scope.timeList[index]["valid"] == 0){
            growl.addInfoMessage("这段时间已经被占用！");
        }
        else {
            if($scope.timeList[index]["valid"] == 2){
                $scope.timeList[index]["valid"] = 1;
            }
            else {
                $scope.timeList[index]["valid"] = 2;
            }
        }
    }

    // 确定
    $scope.audit = function(){

        // 选择的数组
        var chooseList = [];
        $.each($scope.timeList,function(index,value){
            if(value["valid"] == 2){
                chooseList.push(value);
            }
        });

        // 判断选择的时间是不是连续
        var len = chooseList.length;
        var flag = true;
        for(var i = 0;i < len - 1;i++){
            var next = parseInt(chooseList[i+1].hour);
            var pre = parseInt(chooseList[i].hour);
            if(next - pre > 1){
                flag = false;
            }

        }

        // 拼接商品ID
        var goodsContent = "";
        $.each($scope.chooseGoodsList, function(index, value){
            goodsContent += value.goodsID + "," + value.activityPrice + "," + value.format + "," + value.limit + "," + value.number + "," + value.skuID + ";";
        });
        if(flag){

            $("#auditDetail").modal("hide");

            swal({
                title:"确认分配活动时间!",
                text:"",
                type:"info",
                showCancelButton:true,
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认",
                cancelButtonText:"取消"

            },
                function(){
                    $.ajax({
                        url:"activity.do?method=createActivity",
                        type:"POST",
                        data:{"content":goodsContent,"time":$scope.searchTime,"sHour":chooseList[0]["hour"],"eHour":chooseList[len-1]["hour"] + 1,"station":1,'account':$scope.userName}
                    })
                        .done(function(response){
                            var result = response.json;
                            if(result){
                                swal({
                                    title:"成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });

                                // 商家列表
                                $scope.shopList = [];
                                // 选取商品的列表
                                $scope.goodsList = [];
                                // 活动商品列表
                                $scope.chooseGoodsList = [];

                                $scope.$apply();

                                getActivityList();

                            }
                            else {
                                swal({
                                    title:"失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }


                        })
                        .fail(function(){
                            swal({
                                title:"网络错误！",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        });
                }
            );



        }
        else {
            growl.addInfoMessage("时间不合法！");
        }





    }


    // 时间的标题
    $scope.timeTitle = [
        "0:00 ~ 1:00",
        "1:00 ~ 2:00",
        "2:00 ~ 3:00",
        "3:00 ~ 4:00",
        "4:00 ~ 5:00",
        "5:00 ~ 6:00",
        "6:00 ~ 7:00",
        "7:00 ~ 8:00",
        "8:00 ~ 9:00",
        "9:00 ~ 10:00",
        "10:00 ~ 11:00",
        "11:00 ~ 12:00",
        "12:00 ~ 13:00",
        "13:00 ~ 14:00",
        "14:00 ~ 15:00",
        "15:00 ~ 16:00",
        "16:00 ~ 17:00",
        "17:00 ~ 18:00",
        "18:00 ~ 19:00",
        "19:00 ~ 20:00",
        "20:00 ~ 21:00",
        "21:00 ~ 22:00",
        "22:00 ~ 23:00",
        "23:00 ~ 24:00",
    ];

});

/* -------------------------- 服务商的设置 ---------------------------------------- */
app.controller("serviceProvider",function($scope,ipCookie,$http){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }

    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }



    // 获得服务商列表
    function getServiceList(){
        $.ajax({
            url:'order.do?method=expressCompany',
            type:"POST",
            success:function(response){

                $scope.serviceList = response.json;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });

            }
        });

    }
    getServiceList();

    $scope.openService = function(index){
        $.ajax({
            url:"order.do?method=addExpressCompany",
            type:"POST",
            data:{'expressKey':$scope.serviceList[index].expresskey,'account':$scope.userName},
            success:function(response){
                var tag = response.json;
                if(tag == 1){
                    getServiceList();
                }
                else if(tag == -1){
                    swal({
                        title:"操作失败！",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                    });
                }
            },
            error:function(){
                swal({
                    title:'网络错误!',
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    $scope.stopService = function(index){
        $.ajax({
            url:"order.do?method=addExpressCompany",
            type:"POST",
            data:{'expressKey':$scope.serviceList[index].expresskey,'account':$scope.userName},
            success:function(response){
                var tag = response.json;
                if(tag == 1){
                    getServiceList();
                }
                else if(tag == -1){
                    swal({
                        title:"操作失败！",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                    });
                }
            },
            error:function(){
                swal({
                    title:'网络错误!',
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }
});

/* -------------------------- 退款订单处理 ---------------------------------------- */
app.controller('handleRefund',function($scope,ipCookie,$http){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 退款列表
    $scope.refundList = null;
    // 页数
    $scope.pageIndex = 1;
    $scope.refundTypeTitle = ['礼品卡退款','微信退款','支付宝退款'];
    // 获取退货列表
    function getRefundList(){
        $.ajax({
            url:"order.do?method=refundList",
            type:"POST",
            data:{"station":100,"page":$scope.pageIndex},
            success:function(response){
                $scope.refundList = response.json;
                $scope.$apply();
            },
            error:function(response){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getRefundList();

    // 查看商家留言
    $scope.getBussinessMessage = function(index) {
        var message = $scope.refundList[index]["shopMessage"];
        swal({
            title:'商家留言',
            text:message,
            type:"info",
            confirmButtonText:"确认"
        });
    }

    // 查看用户的留言
    $scope.getClientMessage = function(index){
        var message = $scope.refundList[index]["clientMessage"];
        swal({
            title:'用户留言',
            text:message,
            type:"info",
            confirmButtonText:"确认"
        });
      }

    // 同意退款
    $scope.agreeRefund = function(index){
        swal({
                title:"确认退款？",
                text:"",
                type:"info",
                animation:"slide-from-top",
                showCancelButton:true,
                cancelButtonText:"取消",
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认"
            },
            function(){
                $.ajax({
                    url:"order.do?method=refundVerify",
                    type:'POST',
                    data:{'refundID':$scope.refundList[index].refundID,'station':2},
                    success:function(response){
                        var tag = response.json;
                        if(tag == 1){
                            swal({
                                title:"退款成功!",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            });
                            getRefundList();
                        }
                        else if(tag == -1){
                            swal({
                                title:"拒绝退款!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                        else {
                            var batchNo = tag.batchNo;
                            var batchNUm = tag.batchNum;
                            var batchDetail = tag.refundDetail;
                            swal({
                                title:"前往支付宝退款界面!",
                                text:"",
                                type:"success",
                                confirmButtonText:"确认"
                            },function(){
                                    window.open('../jsp/index.jsp?batchID='+ batchNo +'&batchNum='+ batchNUm + '&batchDetail=' + batchDetail);
                                }
                            );

                        }
                    },
                    error:function(){
                        swal({
                            title:"网络错误!",
                            text:"",
                            type:'error',
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
        );

    }

    // 拒绝退款
    $scope.rejectRefund = function(index){
        swal({
            title:"输入拒绝的理由",
            text:"",
            type:"input",
            animation:"slide-from-top",
            showCancelButton:true,
            cancelButtonText:"取消",
            closeOnConfirm:false,
            showLoaderOnConfirm:true,
            confirmButtonText:"确认"
        },
        function(inputValue){
            if(inputValue === false){
                return false;
            }
            if(inputValue === ""){
                swal.showInputError("请输入理由！");
                return false;
            }

            $.ajax({
                url:"order.do?method=refundVerify",
                type:"POST",
                data:{"refundID":$scope.refundList[index].refundID,"station":-2,"message":inputValue},
                success:function(response){
                    var tag = response.json;
                    if(tag == 1){
                        swal({
                            title:"操作成功!",
                            text:"",
                            type:"success",
                            confirmButtonText:"确认"
                        });
                        $scope.refundList[index].station = -2;
                        $scope.$apply();
                    }
                },
                error:function(response){
                    swal({
                        title:"网络错误!",
                        text:"",
                        type:"error",
                        confirmButtonText:"确认"
                    });
                }
            });
        });
    }
});


/* -------------------------- 一元夺宝 ---------------------------------------- */
app.controller('managerCard',function($scope,ipCookie,$http){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    // 礼品卡列表
    $scope.cardList = null;
    // 礼品卡的页数
    $scope.cardIndex = 1;

    // 状态列表
    $scope.typeList = [
        {"id":0,"title":"未激活"},
        {"id":1,"title":"已经激活"},
        {"id":100,"title":"所有的"},
    ];
    $scope.selectType = $scope.typeList[0];

    $scope.$watch('selectType',function(newValue){
        getCardList();
    });

    function getCardList(){
        $.ajax({
            url:"activity.do?method=giftCardList",
            type:"POST",
            data:{"activation":$scope.selectType.id,"page":$scope.cardIndex},
            success:function(response){
                $scope.cardList = response.json;
                $scope.$apply();
            },
            error:function(response){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getCardList();



    // 礼品卡前一页
    $scope.preCard = function(){
        if($scope.cardIndex == 1){
            swal({
                title:"当前已经是第一页!",
                text:"",
                type:'info',
                confirmButtonText:"确认"
            });

        }
        else {
            $scope.cardIndex--;
            getCardList();

        }
    }

    // 礼品卡后一页
    $scope.nextCard = function(){
        $.ajax({
            url:"activity.do?method=giftCardList",
            type:"POST",
            data:{"activation":$scope.selectType.id,"page":$scope.cardIndex + 1},
            success:function(response){
                if(response.json.length == 0){
                    swal({
                        title:"没有更多!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.cardList = response.json;
                    $scope.cardIndex++;
                    $scope.$apply();
                }
            },
            error:function(response){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }
    $scope.activityPage = 1;
    // 获取活动列表
    function getActivityList(){
        $.ajax({
            url:"activity.do?method=crazyCompetitionList",
            type:"POST",
            data:{"page":$scope.activityPage},
            success:function(response){
                var result = response.json;

                $scope.activityList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }
    getActivityList();

    // 活动列表前一页
    $scope.pre = function(){
        if($scope.activityPage == 1){
            swal({
                title:'当前已经是第一页了！',
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.activityPage--;
            getActivityList();
        }
    }

    // 活动列表后一页
    $scope.next = function(){
        $.ajax({
            url:"activity.do?method=crazyCompetitionList",
            type:"POST",
            data:{"page":$scope.activityPage + 1},
            success:function(response){
                var result = response.json;
               if(result.length == 0){
                    swal({
                        title:"没有更多数据!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
               }
                else {
                   $scope.activityList = result;
                   scope.activityPage++;
                   $scope.$apply();
               }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }


    // 查看购买者
    $scope.peopleList = null;
    $scope.getBuyerList = function(parentIndex,index){

        $.ajax({
            url:"activity.do?method=crazyCompetitionMember",
            type:"POST",
            data:{'cardID':$scope.activityList[parentIndex].card[index].cardID},
            success:function(response){
                var result = response.json;
                $scope.peopleList = result;
                $scope.$apply();
                $('#peopleList').modal('show');
            },
            error:function(){
                swal({
                    title:"网络错误",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });

    }


    /* ------------------------ 生成礼品卡 -------------------------- */
    // 卡的面值
    $scope.cardMoney = 500;
    // 卡的数量
    $scope.cardNumber = null;
    $scope.cardMessage = null;


    // 生成卡
    $scope.createCard = function(){
        $("#createCard").modal("show");

    }
    // 取消生成
    $scope.cancelCard = function(){
        $scope.cardMoney = null;
        $scope.cardNumber = null;
    }
    // 确认能生成
    $scope.sureCard = function(){
        if(!$scope.cardMoney){
            $scope.cardMessage = "请输入礼品卡的面值";
        }
        else if(!$scope.cardNumber) {
            $scope.cardMessage = "请输入礼品卡的数量";
        }
        else if(parseInt($scope.cardNumber) > 20){
            $scope.cardMessage = "一次性最多只能生成20张！";
        }
        else {
            $.ajax({
                url:"activity.do?method=addGiftCard",
                type:"POST",
                data:{"money":$scope.cardMoney,"number":parseInt($scope.cardNumber),'account':$scope.userName},
                success:function(response){
                    var tag = response.json;
                    if(tag == 1){
                        swal({
                            title:"操作成功!",
                            text:"",
                            type:"success",
                            confirmButtonText:"确认"
                        });
                        $("#createCard").modal("hide");
                        $scope.cardMoney = null;
                        $scope.cardNumber = null;
                        getCardList();


                    }
                    else if(tag == -1){
                        swal({
                            title:"操作失败!",
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                    else if(tag == 0){
                        swal({
                            title:"最多只能生成20张!",
                            text:"",
                            type:'error',
                            confirmButtonText:"确认"
                        });
                    }
                }
            });
        }
    }

    /* ------------------------ 开启下一期活动 -------------------------- */
    // 期数
    $scope.cardTimes = null;
    $scope.startNextPeriods = function(){
        getNeedCardList();

        $.ajax({
            url:"activity.do?method=crazyCompetitionEnable",
            type:"POST",
            success:function(response){
                var tag = response.json;
                if(tag == -1){
                    swal({
                        title:"上一期活动还没有结束！不能开启下一期！",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.cardTimes = tag;
                    $scope.$apply();
                    $("#chooseCardList").modal("show");
                }
            }
        });
    }


    // 选择卡片
    $scope.chooseCardList = [];

    // 清除选项
    $scope.removeCard = function(index){
        $scope.chooseCardList.splice(index,1);
    }

    // 需要选择的列表
    $scope.needChooseCardList = null;

    // 炫耀选择的下一页
    $scope.needChoosePage = 1;

    // 选择
    $scope.chooseCard = function(index){
        var temp = $scope.needChooseCardList[index];
        var flag = true;
        $.each($scope.chooseCardList,function(index, value){
            if(value["cardID"] == temp["cardID"]){
                flag = false;
            }
        });

        if(!flag){

        }
        else {
            $scope.chooseCardList.push($scope.needChooseCardList[index]);
        }
    }

    // 获取选择列表
    function getNeedCardList(){
        $.ajax({
            url:"activity.do?method=giftCardList",
            type:"POST",
            data:{"activation":200,"page":$scope.needChoosePage},
            success:function(response){
                var result = response.json;

                $scope.needChooseCardList = result;
                $scope.$apply();
            },
            error:function(response){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }
    getNeedCardList();

    // 选择列表的前一页
    $scope.cardpre = function(){
        if($scope.needChoosePage == 1){
            swal({
                title:"已经是第一页了！",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.needChoosePage--;
            getNeedCardList();
        }
    }
    // 选择列表的后一页
    $scope.cardnext = function(){
        $.ajax({
            url:"activity.do?method=giftCardList",
            type:"POST",
            data:{"activation":200,"page":$scope.needChoosePage + 1},
            success:function(response){
                if(response.json.length == 0){
                    swal({
                        title:"没有更多!",
                        text:"",
                        type:"info",
                        confirmButtonText:"确认"
                    });
                }
                else {
                    var result = response.json;

                    $scope.needChooseCardList = result;
                    $scope.needChoosePage++;
                    $scope.$apply();
                }
            },
            error:function(response){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }

    // 取消选择
    $scope.cancelChoose = function(){
        $scope.chooseCardList = [];
    }

    // 生成期数
    $scope.sureChoose = function(){
        if($scope.chooseCardList.length == 0){
            $scope.errorMessage = "请选择活动的卡片!";
        }
        else {

            $("#chooseCardList").modal("hide");

            swal({
                title:"是否开启一元夺宝活动？",
                text:"",
                type:"info",
                animation:"slide-from-top",
                showCancelButton:true,
                cancelButtonText:"取消",
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认"
            },
                function(){
                    var temp = [];
                    $.each($scope.chooseCardList,function(index,value){
                        temp.push(value.cardID);
                    });

                    var cardIDStr = temp.join(";");

                    $.ajax({
                        url:"activity.do?method=addCrazyCompetition",
                        type:"POST",
                        data:{"phase":$scope.cardTimes,"cardID":cardIDStr,'account':$scope.userName},
                        success:function(response){
                            var tag = response.json;
                            if(tag == 1){
                                swal({
                                    title:"开启成功!",
                                    text:"",
                                    type:"success",
                                    confirmButtonText:"确认"
                                });
                                getActivityList();

                            }
                            else if(tag == -1){
                                swal({
                                    title:"操作失败!",
                                    text:"",
                                    type:"error",
                                    confirmButtonText:"确认"
                                });
                            }
                        },
                        error:function(response){
                            swal({
                                title:"网络错误!",
                                text:"",
                                type:"error",
                                confirmButtonText:"确认"
                            });
                        }
                    });
                }
            );

        }
    }

});

/* -------------------------- 管理员 ---------------------------------------- */
app.controller('guanliyuan',function($scope,ipCookie,growl){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    $scope.key = 0;
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }



    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }


    // 角色名称
    $scope.rightTitle = ["超级管理员",'商户管理员','营销管理员','财务管理员'];


    // 获取管理员列表
    function getUserList(){
        $.ajax({
            url:'system.do?method=managerList',
            type:"POST",
            data:{'right':100},
            success:function(response){
                var result = response.json;
                $scope.managerList = result;
                $scope.$apply();

            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:'error',
                    confirmButtonText:"确认"
                });
            }
        });
    }

    getUserList();

    // 删除管理员
    $scope.delete = function(index){
        swal({
            title:"确定删除这个管理员！",
            text:"",
            type:"info",
            animation:"slide-from-top",
            showCancelButton:true,
            cancelButtonText:"取消",
            closeOnConfirm:false,
            showLoaderOnConfirm:true,
            confirmButtonText:"确认"
        },
            function(){
                $.ajax({
                    url:'system.do?method=managerDel',
                    type:'POST',
                    data:{'account':$scope.managerList[index].account},
                    success:function(response){
                        var tag = response.json;
                        if(tag == 1){
                            swal({
                                title:"操作成功!",
                                text:'',
                                type:'success',
                                confirmButtonText:"确认"
                            });
                            getUserList();
                        }
                        else if(tag == -1){
                            swal({
                                title:"操作失败!",
                                text:"",
                                type:'error',
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(){
                        swal({
                            title:"网络错误!",
                            text:"",
                            type:'error',
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
        );
    }

    // 禁用管理员
    $scope.disuse = function(index){
        swal({
                title:"确定禁用这个管理员！",
                text:"",
                type:"info",
                animation:"slide-from-top",
                showCancelButton:true,
                cancelButtonText:"取消",
                closeOnConfirm:false,
                showLoaderOnConfirm:true,
                confirmButtonText:"确认"
            },
            function(){
                $.ajax({
                    url:'system.do?method=managerForbid',
                    type:'POST',
                    data:{'account':$scope.managerList[index].account},
                    success:function(response){
                        var tag = response.json;
                        if(tag == 1){
                            swal({
                                title:"操作成功!",
                                text:'',
                                type:'success',
                                confirmButtonText:"确认"
                            });
                            getUserList();
                        }
                        else if(tag == -1){
                            swal({
                                title:"操作失败!",
                                text:"",
                                type:'error',
                                confirmButtonText:"确认"
                            });
                        }
                    },
                    error:function(){
                        swal({
                            title:"网络错误!",
                            text:"",
                            type:'error',
                            confirmButtonText:"确认"
                        });
                    }
                });
            }
        );
    }


    $scope.account = null;
    $scope.password = null;
    $scope.itemList = [
        {"right":1,'title':"商户管理员"},
        {"right":2,"title":"营销管理员"},
        {"right":3,'title':"财务管理员"}
    ];

    $scope.manager = $scope.itemList[0];

    // 添加管理员
    $scope.add = function(){
        if(!$scope.account){
            growl.addWarnMessage("请填写账户！");
        }
        else if(!$scope.password){
            growl.addWarnMessage("请填写密码！");
        }
        else{
            $.ajax({
                url:'system.do?method=managerAdd',
                type:"POST",
                data:{'account':$scope.account,'password':$scope.password,'right':$scope.manager.right},
                success:function(response){
                    var tag = response.json;
                    if(tag == 1){
                        swal({
                            title:'添加管理员成功!',
                            text:'',
                            type:'success',
                            confirmButtonText:"确认"
                        });
                        $scope.account = null;
                        $scope.password = null;
                        getUserList();
                    }
                    else {
                        swal({
                            title:'操作失败!',
                            text:"",
                            type:"error",
                            confirmButtonText:"确认"
                        });
                    }
                },
                error:function(){
                    swal({
                        title:"网络错误!",
                        text:"",
                        type:'error',
                        confirmButtonText:"确认"
                    });
                }
            });
        }
    }
});


app.controller('clientMessage',function($scope,ipCookie){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    $scope.key = 0;
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }

    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }

    $scope.messageList = null;
    $scope.pageIndex = 1;
    function getMessage(){
        $.ajax({
            url:"client.do?method=feedback",
            type:"POST",
            data:{"page":$scope.pageIndex},
            success:function(response){
                var result = response.json;
                $scope.messageList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }
    getMessage();


    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前是第一页!",
                text:"",
                type:"info",
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;
            getMessage();
        }
    }

    $scope.next = function(){
        $.ajax({
            url:"client.do?method=feedback",
            type:"POST",
            data:{"page":$scope.pageIndex + 1},
            success:function(response){
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多!",
                        text:"",
                        type:'info',
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.messageList = result;
                    $scope.pageIndex++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:"",
                    type:"error",
                    confirmButtonText:"确认"
                });
            }
        });
    }
});


app.controller('giftCard',function($scope,ipCookie){
    $scope.userName = ipCookie("userName");
    $scope.key = ipCookie('key');
    $scope.key = 0;
    if(!$scope.userName) {
        window.location.href = "../index.html";
    }
    // 礼品卡订单
    $scope.managerGiftCard_link = function(){
        window.location.href = 'giftCardOrderList.html';
    }
    $scope.clientMessage_link = function(){
        window.location.href = "clientMessage.html";
    }
    // 退款处理
    $scope.managerHandleRefund_link = function(){
        window.location.href = "managerHandleRefund.html";
    }
    // 一元夺宝
    $scope.managerCard_link = function(){
        window.location.href = 'managerCard.html';
    }
    // 首页模块管理
    $scope.managerActivityMode_link = function(){
        window.location.href = "managerActivityMode.html";
    }
    // 首页新闻管理
    $scope.managerNews_link = function(){
        window.location.href = "managerNews.html";
    }
    // 权限管理
    $scope.guanliyuan_link = function(){
        window.location.href = "guanliyuan.html";
    }
    // 服务商设置
    $scope.serviceProvider_link = function(){
        window.location.href = "setService.html";
    }

    // 商家轮播图审核
    $scope.managerAuditBanner_link = function(){
        window.location.href = "managerBussinessBanner.html";
    }

    // 首页的链接
    $scope.home_link = function () {
        window.location.href = "manager.html";
    }

    // 用户列表
    $scope.manageruserlist_link = function () {
        window.location.href = "manageruser.html";
    }

    // 注册的用户
    $scope.managernewuser_link = function () {
        window.location.href = "managernewusers.html";
    }

    // 活跃用户分布
    $scope.manageractiveuser_link = function () {
        window.location.href = "manageractiveuser.html";
    }

    // 加盟审核
    $scope.managerjoinaudit_link = function () {
        window.location.href = "managerJoinAudit.html";
    }

    // 商户分账
    $scope.managerPayMoney_link = function() {
        window.location.href = "managerPayMoney.html";
    }

    // 商户经营
    $scope.managerBussinessOperation_link = function() {
        window.location.href = "managerBussinessOperation.html";
    }


    // 发送消息
    $scope.managerSendMessage_link = function() {
        window.location.href = "managerSendMessage.html";
    }

    // 关停商户
    $scope.managerStopShop_link = function () {
        window.location.href = "managerStopShop.html";
    }


    // 下架商品
    $scope.managerStopGoods_link = function () {
        window.location.href = "managerStopGoods.html";
    }

    // 审核商品
    $scope.auditGoods_link = function() {
        window.location.href = "managerGoodsAudit.html";
    }


    // 商品投诉
    $scope.managerComplaintGoods_link = function () {
        window.location.href = "managerComplaintGoods.html";
    }

    // 今日订单
    $scope.managerOrderList_link = function () {
        window.location.href = "managerOrderList.html";
    }

    // 开通城市
    $scope.openCity_link = function(){
        window.location.href = "openCity.html";
    }

    // 首页轮播图
    $scope.managerBanner_link = function(){
        window.location.href = "managerBanner.html";
    }
    // 活动管理
    $scope.auditActivity_link = function(){
        window.location.href = "managerActivity.html";
    }


    $scope.pageIndex = 1;
    $scope.giftList = null;
    function getCardList(){
        $.ajax({
            url:"order.do?method=gOrderList",
            type:'POST',
            data:{'page':$scope.pageIndex},
            success:function(response){
                var result = response.json;
                $scope.giftList = result;
                $scope.$apply();
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:'',
                    type:'error',
                    confirmButtonText:'确认'
                });
            }
        });
    }
    getCardList();


    // 前一页
    $scope.pre = function(){
        if($scope.pageIndex == 1){
            swal({
                title:"当前是第一页!",
                text:'',
                type:'info',
                confirmButtonText:"确认"
            });
        }
        else {
            $scope.pageIndex--;
            getCardList();
        }
    }

    // 后一页
    $scope.next = function(){
        $.ajax({
            url:"order.do?method=gOrderList",
            type:'POST',
            data:{'page':$scope.pageIndex + 1},
            success:function(response){
                var result = response.json;
                if(result.length == 0){
                    swal({
                        title:"没有更多!",
                        text:'',
                        type:'info',
                        confirmButtonText:"确认"
                    });
                }
                else {
                    $scope.giftList = result;
                    $scope.pageIndex++;
                    $scope.$apply();
                }
            },
            error:function(){
                swal({
                    title:"网络错误!",
                    text:'',
                    type:'error',
                    confirmButtonText:'确认'
                });
            }
        });
    }
});


/*
 * * ----------------------------------------- 一些公用函数
 * ------------------------------ * / /* 全国活跃用户的呈现
 */
function addUserMap(data){

    console.log(data);

    var chart = echarts.init(document.getElementById('userdatachart'));

    option = {
        title: {
            text: '全国的活跃用户分布',
            left: 'center'
        },
        // 浮动框
        tooltip: {
            trigger: 'item'
        },

        visualMap: {
            min: 0,
            max: 10000,
            left: 'left',
            top: 'bottom',
            text: ['高','低'],           // 文本，默认为数值文本
            calculable: true
        },
        series: [
            {
                name: '用户数量',
                type: 'map',
                map: 'china',
                roam: false,
                data:data
            }
        ]
    };

    chart.setOption(option);

}

/* 注册用户的数据展示 */

function newUsersChart(title,time,timearray,userAmount) {

    var chart = echarts.init(document.getElementById('userdatachart'));

    option = {
        title: {
            text: time +" "+ title + '新用户分布',


        },
        tooltip: {
            trigger: 'axis'
        },
        xAxis:  {
            type: 'category',
            boundaryGap: false,
            data: timearray
        },
        yAxis: {
            type: 'value',
            axisLabel: {
                formatter: '{value} '
            }
        },
        series: [
            {
                name:'新用户注册量',
                type:'line',
                data:userAmount,
                markPoint: {
                    data: [
                        {type: 'max', name: '最大值'},
                        {type: 'min', name: '最小值'}
                    ]
                }
            },
        ]
    };

    chart.setOption(option);

}


/* 专营店的销售情况 */

function shopChart(dic) {

    var chart = echarts.init(document.getElementById('userdatachart'));


    var option = {
        title: {
            text:"商店的经营情况",
            left: "center"
        },
        tooltip: {
            trigger: 'axis'
        },
        xAxis: [
            {
                type: 'category',
                data: dic["xArray"]        // x轴的数组
            }
        ],
        yAxis: [
            {
                type: 'value',
                name: '销售量',
                axisLabel: {
                    formatter: '{value} 件'
                }
            },
            {
                type: 'value',
                name: '销售额',
                axisLabel: {
                    formatter: '{value} 元'
                }
            }
        ],
        series: [
            {
                name:'销售量',
                type:'bar',
                data:dic["saleAmount"]             // 销售量的数组
            },
            {
                name:'销售额',
                type:'line',
                yAxisIndex: 1,
                data:dic["saleMoney"]             // 销售额的数组
            }
        ]
    };


    chart.setOption(option);
}

function getymd(){
    var nowtime = new Date();
    var year = nowtime.getFullYear();
    var month = nowtime.getMonth() + 1;
    if(month < 10){
        month = "0" + month;
    }
    var day = nowtime.getDate();
    if(day < 10){
        day = "0" + day;
    }
    var timeFormatter = year + "-" + month + "-" + day;

    return timeFormatter;
}

//设置iframe自适应高度
function reinitIframe(){  
    var iframe = document.getElementById("rightContentFrame");  
    try{  
        var bodyHeight = iframe.contentWindow.document.body.scrollHeight;  
        var documentHeight = iframe.contentWindow.document.documentElement.scrollHeight;  
        var height = Math.max(bodyHeight, documentHeight);  
        iframe.height = height;  
    }catch (ex){}  
    }  
      
    var timer1 = window.setInterval("reinitIframe()", 500); //定时开始  
      
    function reinitIframeEND(){  
    var iframe = document.getElementById("rightContentFrame");  
    try{  
        var bodyHeight = iframe.contentWindow.document.body.scrollHeight;  
        var documentHeight = iframe.contentWindow.document.documentElement.scrollHeight;  
        var height = Math.max(bodyHeight, documentHeight);  
        iframe.height = height;  
    }catch (ex){}  
    // 停止定时  
    window.clearInterval(timer1);  
      
    }  

app.controller('giftCardController', function($scope, ipCookie, growl) {

});

